!function(){"use strict";function a(e,o){if("object"==typeof console&&"function"==typeof console.error&&"function"==typeof console.info&&"function"==typeof console.warn)if(e="object"==typeof e?(e.unshift("["+t+"]\n"),e):["["+t+"]\n"+e],void 0===o||"alerta"!==o.toLowerCase()&&"aviso"!==o.toLowerCase())if(void 0!==o&&"info"===o.toLowerCase())try{console.info.apply(console,e)}catch(o){console.info(e.join("\n"))}else try{console.error.apply(console,e)}catch(o){console.error(e.join("\n"))}else try{console.warn.apply(console,e)}catch(o){console.warn(e.join("\n"))}}var t="Orion - localStorage",r=(window.orionLocalStorage=window.orionLocalStorage||{},"undefined"!=typeof localStorage&&void 0!==localStorage.setItem&&void 0!==localStorage.getItem);window.orionLocalStorage.setItem=function(o,e,t){try{if(!r)return!1;var n=new Date;localStorage.setItem(o,e),isNaN(parseInt(t))||(n.setTime(n.getTime()+60*t*1e3),localStorage.setItem(o+"_expiration",n.getTime()))}catch(o){a(["Erro ao salvar os dados: ",o.message],"alerta")}},window.orionLocalStorage.getItem=function(o){try{if(!r)return!1;var e=new Date,t=parseInt(localStorage.getItem(o+"_expiration")||0,10)||0;return e.getTime()>t?(localStorage.removeItem&&(localStorage.removeItem(o),localStorage.removeItem(o+"_expiration")),null):localStorage.getItem(o)}catch(o){a(["Erro ao salvar os dados: ",o.message],"alerta")}}}(),function(){try{let n={init:()=>{n.getProductInfo(),n.consultCPF(),n.verifyToken(),n.applyMaskCPF(),n.buttonsConfigs()},windowOnload:()=>{},ajaxStop:()=>{},dataToken:{},getProductInfo:()=>{$(".dag-shelf-wrapper li[layout] .dag-storefront.main").each(async function(){let o=$(this),e=o.attr("product-id");var t;orionLocalStorage.getItem("dagProductData_"+e)?o.find(".block-btn-promotion.info-discount").addClass("active-info-discount"):(t=(await $.ajax({type:"GET",url:"/api/catalog_system/pub/products/search/?fq=productId:"+e,dataType:"json",contentType:"application/json",headers:{"Content-Type":"application/json",Accept:"application/vnd.vtex.ds.v10+json"}}))[0]).productPbmOn&&t.productPbmOn&&"S"==t.productPbmOn&&(console.log(`Prod: ${t.productId} DENTRO! no programa, Salvando...`),console.log(t),o.find(".block-btn-promotion.info-discount").addClass("active-info-discount"),window.orionLocalStorage.setItem("dagProductData_"+t.productId,JSON.stringify(t),120),t={EAN:t.items[0].ean,requestedQuantity:o.find(".block-buybutton.quantity input").val(),listPrice:t.items[0].sellers[0].commertialOffer.ListPrice,netPrice:t.items[0].sellers[0].commertialOffer.Price,discountType:"B"},console.log(t),n.consultProduct(t))})},consultProduct:o=>{$.cookie("dagInterplayersToken")},verifyToken:()=>{if($.cookie("dagInterplayersToken")){var o=$.cookie("dagInterplayersToken_expiration"),o=new Date(o);if(new Date<o)return void console.log("Token Existe!");console.log("Limpando coockie."),$.removeCookie("dagInterplayersToken"),$.removeCookie("dagInterplayersToken_expiration")}n.getToken()},getToken:()=>{$.ajax({type:"POST",url:"https://api-mng.interplayers.com.br/gip-scs-svc/token",data:{Client_Id:"36C0ED06-5F33-448C-96E4-A5AE1AAD3142",Client_Secret:"VP2TQfEL#mF3!rsW",Grant_Type:"client_credentials"}}).done(function(o){n.dataToken=o;let e=n.dateConverterToBrazilTimezone();$.cookie("dagInterplayersToken",o.access_token,{expires:1}),$.cookie("dagInterplayersToken_expiration",e.toString(),{expires:1})})},applyMaskCPF:()=>{$(".block-btn-promotion.input-cpf input").mask("000.000.000-00",{reverse:!0})},buttonsConfigs:()=>{let o=$(".block-btn-promotion.info-discount"),e=$(".dag-storefront-pbm-btn-add"),t=$(".dag-storefront-pbm-btn-remove"),n=$(".dag-storefront.pbm-block .box-terms-btn-close");o.on("click",function(o){o.preventDefault();let e=$(this);e.removeClass("active-info-discount"),e.siblings(".block-btn-promotion.input-cpf").addClass("active-input-cpf")}),e.on("click",function(o){o.preventDefault();let e=$(this);if(e.prev().val().length<14)alert("Numero de CPF incompleto.");else{let o=e.closest(".dag-storefront.main");o.addClass("pbm-loader-on"),o.find(".dag-storefront.content").removeClass("content-on"),o.find(".dag-storefront.discount-loader").addClass("active-loader-pbm"),setTimeout(function(){o.find(".pbm-block.box-terms-register").addClass("active-box-terms-register"),o.find(".block-btn-promotion.input-cpf").removeClass("active-input-cpf"),o.find(".dag-storefront.discount-loader").removeClass("active-loader-pbm"),o.removeClass("pbm-loader-on"),o.find(".dag-storefront.content").addClass("content-on")},2e3)}}),t.on("click",function(o){o.preventDefault();let e=$(this).closest(".dag-storefront.main");e.addClass("pbm-loader-on"),e.find(".dag-storefront.content").hide(),e.find(".dag-storefront.discount-loader").addClass("active-loader-pbm"),setTimeout(function(){e.find(".block-btn-promotion.discount-applied").removeClass("active-discount-applied"),e.find(".block-btn-promotion.info-discount").addClass("active-info-discount"),e.removeClass("pbm-loader-on"),e.find(".dag-storefront.discount-loader").removeClass("active-loader-pbm"),e.find(".dag-storefront.content").show()},2e3)}),n.on("click",function(o){o.preventDefault();let e=$(this).closest(".dag-storefront.pbm-block");e.find(".box-terms-register, .box-term-autorize").removeClass("active-box-terms-register active-box-terms-autorize"),e.find(".block-btn-promotion.info-discount").addClass("active-info-discount")})},consultCPF:()=>{$(".dag-storefront-pbm-btn-add").on("click",function(o){o.preventDefault(),$(this).prev().val().length<14?alert("CPF Incompleto."):console.log("Submetido!")})},dateConverterToBrazilTimezone:()=>{let o=new Date;var e=(o=new Date(o.getTime()+18e5)).getFullYear().toString()+"-";return(e=(e=(e=(e+=(o.getMonth()+1).toString().padStart(2,"0")+"-")+(o.getDate().toString().padStart(2,"0")+"T"))+(o.getHours().toString().padStart(2,"0")+":"))+(o.getMinutes().toString().padStart(2,"0")+":"))+o.getSeconds().toString().padStart(2,"0")}};$(document).ready(n.init);$(window).load(function(){n.windowOnload()}),$(document).ajaxStop(n.ajaxStop)}catch(o){console.log("Erro na inst√¢ncia do [PBMstorefront]: ",o)}}();