!function(){"use strict";function a(o,e){if("object"==typeof console&&"function"==typeof console.error&&"function"==typeof console.info&&"function"==typeof console.warn)if(o="object"==typeof o?(o.unshift("["+t+"]\n"),o):["["+t+"]\n"+o],void 0===e||"alerta"!==e.toLowerCase()&&"aviso"!==e.toLowerCase())if(void 0!==e&&"info"===e.toLowerCase())try{console.info.apply(console,o)}catch(e){console.info(o.join("\n"))}else try{console.error.apply(console,o)}catch(e){console.error(o.join("\n"))}else try{console.warn.apply(console,o)}catch(e){console.warn(o.join("\n"))}}var t="Orion - localStorage",r=(window.orionLocalStorage=window.orionLocalStorage||{},"undefined"!=typeof localStorage&&void 0!==localStorage.setItem&&void 0!==localStorage.getItem);window.orionLocalStorage.setItem=function(e,o,t){try{if(!r)return!1;var n=new Date;localStorage.setItem(e,o),isNaN(parseInt(t))||(n.setTime(n.getTime()+60*t*1e3),localStorage.setItem(e+"_expiration",n.getTime()))}catch(e){a(["Erro ao salvar os dados: ",e.message],"alerta")}},window.orionLocalStorage.getItem=function(e){try{if(!r)return!1;var o=new Date,t=parseInt(localStorage.getItem(e+"_expiration")||0,10)||0;return o.getTime()>t?(localStorage.removeItem&&(localStorage.removeItem(e),localStorage.removeItem(e+"_expiration")),null):localStorage.getItem(e)}catch(e){a(["Erro ao salvar os dados: ",e.message],"alerta")}}}(),function(){try{var e="https://drogariaglobo-middleware.herokuapp.com";let r={init:()=>{r.getProductInfo(),r.verifyToken(),r.applyMaskCPF(),r.buttonsConfigs(),r.closeAcceptModal(),r.selectDiscountValue()},windowOnload:()=>{},ajaxStop:()=>{},routes:{getToken:"https://api-mng.interplayers.com.br/gip-scs-svc/token",getConsultDiscount:e+"/dagmiddleware/consult-discount",getConsultProduct:e+"/dagmiddleware/consult-product",getActiveCustomer:""},getProductInfo:()=>{$(".dag-shelf-wrapper li[layout] .dag-storefront.main").each(async function(){let e=$(this),o=e.attr("product-id");var t;orionLocalStorage.getItem("dagProductData_"+o)?(t=localStorage.getItem("dagProductData_"+o),t=JSON.parse(t),r.savingInfosProductsEAN(e,t,o)):(t=(await $.ajax({type:"GET",url:"/api/catalog_system/pub/products/search/?fq=productId:"+o,dataType:"json",contentType:"application/json",headers:{"Content-Type":"application/json",Accept:"application/vnd.vtex.ds.v10+json"}}))[0]).productPbmOn&&t.productPbmOn&&"S"==t.productPbmOn&&(console.log(`Prod: ${t.productId} DENTRO! no programa, Salvando...`),console.log(t),window.orionLocalStorage.setItem("dagProductData_"+t.productId,JSON.stringify(t),120),r.savingInfosProductsEAN(e,t,o))})},savingInfosProductsEAN:async(e,o,t)=>{e.find(".block-btn-promotion.info-discount").addClass("active-info-discount");var n={EAN:o.items[0].ean,requestedQuantity:e.find(".block-buybutton.quantity input").val(),listPrice:o.items[0].sellers[0].commertialOffer.ListPrice,netPrice:o.items[0].sellers[0].commertialOffer.Price,discountType:"B"},a={product:[n],token:$.cookie("dagInterplayersToken")};if(orionLocalStorage.getItem("dagConsultProductData_"+t)){o=localStorage.getItem("dagConsultProductData_"+t),o=JSON.parse(o),o={basePrice:n.netPrice,discountPercentage:o.product[0].discountPercentual,productStore:o.product[0].industryName};r.setBaseDiscount(e,o)}else{const o=await r.requestConsultProduct(a);"N000"==o.returnCode&&(window.orionLocalStorage.setItem("dagConsultProductData_"+t,JSON.stringify(o),120),a={basePrice:n.netPrice,discountPercentage:o.product[0].discountPercentual,productStore:o.product[0].industryName},r.setBaseDiscount(e,a))}},setBaseDiscount:(e,o)=>{var t="0."+o.discountPercentage;t=parseFloat(t);let n=(parseInt(o.basePrice)*t).toFixed(2);n=n.replace(".",","),e.find(".pbm-price").text("R$ "+n)},requestConsultProduct:e=>$.ajax({type:"POST",url:r.routes.getConsultProduct,data:e}),verifyToken:()=>{if($.cookie("dagInterplayersToken")){var e=$.cookie("dagInterplayersToken_expiration"),e=new Date(e);if(new Date<e)return void console.log("Token Existe!");console.log("Limpando coockie."),$.removeCookie("dagInterplayersToken"),$.removeCookie("dagInterplayersToken_expiration")}r.getToken()},getToken:()=>{$.ajax({type:"POST",url:r.routes.getToken,data:{Client_Id:"36C0ED06-5F33-448C-96E4-A5AE1AAD3142",Client_Secret:"VP2TQfEL#mF3!rsW",Grant_Type:"client_credentials"}}).done(function(e){r.dataToken=e;let o=r.dateConverterToBrazilTimezone(!0);$.cookie("dagInterplayersToken",e.access_token,{expires:1}),$.cookie("dagInterplayersToken_expiration",o.toString(),{expires:1})})},applyMaskCPF:()=>{$(".block-btn-promotion.input-cpf input").mask("000.000.000-00",{reverse:!0})},buttonsConfigs:()=>{let e=$(".block-btn-promotion.info-discount"),o=$(".dag-storefront-pbm-btn-add"),t=$(".dag-storefront-pbm-btn-remove"),n=$(".dag-storefront.pbm-block .box-terms-btn-close");e.on("click",function(e){e.preventDefault();let o=$(this),t=o.closest(".dag-storefront.main");r.functionsShowStepsPbm.showFieldCPF(o,t)}),o.on("click",function(e){e.preventDefault();let o=$(this),t=o.prev().val(),n=o.attr("field-product-id");t.length<14?alert("CPF Incompleto."):r.doIntegration(t,n)}),t.on("click",function(e){e.preventDefault();let o=$(this).closest(".dag-storefront.main");o.addClass("pbm-loader-on"),o.find(".dag-storefront.content").hide(),o.find(".dag-storefront.discount-loader").addClass("active-loader-pbm"),setTimeout(function(){o.find(".block-btn-promotion.discount-applied").removeClass("active-discount-applied"),o.find(".block-btn-promotion.info-discount").addClass("active-info-discount"),o.removeClass("pbm-loader-on"),o.find(".dag-storefront.discount-loader").removeClass("active-loader-pbm"),o.find(".dag-storefront.content").show()},2e3)}),n.on("click",function(e){e.preventDefault();let o=$(this).closest(".dag-storefront.pbm-block");o.find(".box-terms-register, .box-term-autorize").removeClass("active-box-terms-register active-box-terms-autorize"),o.find(".block-btn-promotion.info-discount").addClass("active-info-discount")})},doIntegration:(e,o)=>{swal({icon:"https://drogariaglobo.vteximg.com.br/arquivos/drogariaglobo-loading-modal.gif",title:"Consultando...",text:"Por favor não saia ou recarregue a página",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,showCloseButton:!1,showCancelButton:!1,buttons:!1,closeOnClickOutside:!1,didOpen:()=>{Swal.showLoading()}}),e=e.replace(/[^\w\s]/g,"");let t=localStorage.getItem("dagProductData_"+o);var o=(t=JSON.parse(t)).items[0].sellers[0].commertialOffer.ListPrice.toString().replace(".",""),n=t.items[0].sellers[0].commertialOffer.Price.toString().replace(".",""),o={id:t.productId,packId:0,EAN:t.items[0].ean,requestedQuantity:1,listPrice:o,netPrice:n,discountType:"B"},n={id:t.productId,EAN:t.items[0].ean,requestedQuantity:1};localStorage.setItem("dagCurrentProductPBM",JSON.stringify(n)),r.integrationStepsConsult(e,o)},integrationStepsConsult:async(e,o)=>{var t,e={token:$.cookie("dagInterplayersToken"),control:{clientId:"36C0ED06-5F33-448C-96E4-A5AE1AAD3142",username:"A5FB2147-D606-6DEA-8314-17D5644B19D3",tableId:"37303932-3232-3130-3330-393933333632",localNumber:8888,centralNumber:localStorage.getItem("dagCentralNumber")||0,localHour:r.dateConverterToBrazilTimezone(null),industryId:"999",stationId:"",companyCode:"99999994001998",attendanceHash:"",terminalId:"ECOMMERCE"},consumer:{holderId:e,cardId:""},product:[o]},e=await r.requestConsultDiscount(e);swal.close(),"H119"==e.returnCode?(console.log("STATUS: H119"),t={url:e.control.urlAcceptTerm,text:e.informativeText},r.showAcceptTermsModal(t)):"Q294"==e.returnCode?(console.log("STATUS: Q294"),localStorage.setItem("dagCentralNumber",e.control.centralNumber),swal({title:"Termos aceitos!",text:"Agora o proximo passo é realizar seu cadastro, redirecionando para o formulario.",icon:"success",closeOnClickOutside:!1}).then(()=>{window.location.pathname="/cadastro-programa"})):"H127"==e.returnCode?swal({title:"Atenção",text:e.informativeText,icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()}):"N000"==e.returnCode&&r.showPBMproductsDiscounts(o.id,e)},requestConsultDiscount:e=>$.ajax({type:"POST",url:r.routes.getConsultDiscount,data:e}),showAcceptTermsModal:e=>{var o=`<iframe src="${e.url}"></iframe>`;$(".dag-terms-modal.block-terms-info").html(`<p>${e.text}</p>`),$(".dag-terms-modal.block-terms").html($(o)),$(document.body).addClass("term-modal-on")},showPBMproductsDiscounts:(e,o)=>{let t=o.product,n="",a=(t.forEach(e=>{console.log("Produto"),console.log(e),console.log("\n");let o=parseInt(e.discountValue);o=o.toLocaleString("pt-br",{style:"currency",currency:"BRL"});e=`<div class="box-unitys-inputs-prices"><span class="box-unitys-inputs-prices--check"></span><span class="box-unitys-inputs-prices--unity">${e.authorizedQuantity} UN.</span><span class="box-unitys-inputs-prices--value">${o}</span></div>`;n+=e}),$(`.dag-storefront.main[product-id="${e}"]`));a.find(".box-unitys-inputs-wrapper").html(n),r.functionsShowStepsPbm.showProductsDiscounts(a)},closeAcceptModal:()=>{$("#dag-btn-terms-modal-reload").on("click",function(e){e.preventDefault(),$(".dag-terms-modal.block-terms").empty(),$(document.body).removeClass("term-modal-on"),window.location.reload()})},selectDiscountValue:()=>{console.log("aquiuiuidsaudsa");var e=$(".box-unitys-inputs-prices--check");$(document).on("click",e,function(e){e.preventDefault(),e.stopPropagation(),$(e.target).is(".box-unitys-inputs-prices--check")&&($(e.target).parent().siblings().removeClass("discount-selected"),$(e.target).parent().addClass("discount-selected"))})},functionsShowStepsPbm:{showDefault:function(){elem.find(".block-btn-promotion.discount-applied").addClass("active-discount-applied"),elem.find(".block-btn-promotion.input-cpf").removeClass("active-input-cpf"),elem.find(".dag-storefront.discount-loader").removeClass("active-loader-pbm"),elem.removeClass("pbm-loader-on"),elem.find(".dag-storefront.content").show()},showFieldCPF:function(e){e.removeClass("active-info-discount"),e.siblings(".block-btn-promotion.input-cpf").addClass("active-input-cpf")},showRegister:function(){elem.find(".pbm-block.box-terms-register").addClass("active-box-terms-register"),elem.find(".block-btn-promotion.input-cpf").removeClass("active-input-cpf"),elem.find(".dag-storefront.discount-loader").removeClass("active-loader-pbm"),elem.removeClass("pbm-loader-on"),elem.find(".dag-storefront.content").addClass("content-on")},showTerms:function(){elem.find(".pbm-block.box-term-autorize").addClass("active-box-terms-autorize"),elem.find(".block-btn-promotion.input-cpf").removeClass("active-input-cpf"),elem.find(".dag-storefront.discount-loader").removeClass("active-loader-pbm"),elem.removeClass("pbm-loader-on"),elem.find(".dag-storefront.content").addClass("content-on")},showProductsDiscounts:function(e){e.find(".block-btn-promotion.input-cpf").removeClass("active-input-cpf"),e.find(".dag-storefront.pbm-block").addClass("box-unity-on")},showActivedDiscountSeted:function(){}},dateConverterToBrazilTimezone:e=>{let o=new Date;e=(o=e?new Date(o.getTime()+18e5):o).getFullYear().toString()+"-";return(e=(e=(e=(e+=(o.getMonth()+1).toString().padStart(2,"0")+"-")+(o.getDate().toString().padStart(2,"0")+"T"))+(o.getHours().toString().padStart(2,"0")+":"))+(o.getMinutes().toString().padStart(2,"0")+":"))+o.getSeconds().toString().padStart(2,"0")}};$(document).ready(r.init);$(window).load(function(){r.windowOnload()}),$(document).ajaxStop(r.ajaxStop)}catch(e){console.log("Erro na instância do [PBMstorefront]: ",e)}}();