!function(){"use strict";function n(e,o){if("object"==typeof console&&"function"==typeof console.error&&"function"==typeof console.info&&"function"==typeof console.warn)if(e="object"==typeof e?(e.unshift("["+t+"]\n"),e):["["+t+"]\n"+e],void 0===o||"alerta"!==o.toLowerCase()&&"aviso"!==o.toLowerCase())if(void 0!==o&&"info"===o.toLowerCase())try{console.info.apply(console,e)}catch(o){console.info(e.join("\n"))}else try{console.error.apply(console,e)}catch(o){console.error(e.join("\n"))}else try{console.warn.apply(console,e)}catch(o){console.warn(e.join("\n"))}}var t="Orion - localStorage",r=(window.orionLocalStorage=window.orionLocalStorage||{},"undefined"!=typeof localStorage&&void 0!==localStorage.setItem&&void 0!==localStorage.getItem);window.orionLocalStorage.setItem=function(o,e,t){try{if(!r)return!1;var a=new Date;localStorage.setItem(o,e),isNaN(parseInt(t))||(a.setTime(a.getTime()+60*t*1e3),localStorage.setItem(o+"_expiration",a.getTime()))}catch(o){n(["Erro ao salvar os dados: ",o.message],"alerta")}},window.orionLocalStorage.getItem=function(o){try{if(!r)return!1;var e=new Date,t=parseInt(localStorage.getItem(o+"_expiration")||0,10)||0;return e.getTime()>t?(localStorage.removeItem&&(localStorage.removeItem(o),localStorage.removeItem(o+"_expiration")),null):localStorage.getItem(o)}catch(o){n(["Erro ao salvar os dados: ",o.message],"alerta")}}}(),function(){try{let i={init:()=>{i.getProductInfo(),i.consultCPF(),i.verifyToken(),i.applyMaskCPF(),i.buttonsConfigs(),i.closeAcceptModal()},windowOnload:()=>{},ajaxStop:()=>{},routes:{getToken:"https://api-mng.interplayers.com.br/gip-scs-svc/token",getConsultDiscount:"https://drogariaglobo-middleware.herokuapp.com/dagmiddleware/consult-discount",getActiveCustomer:""},getProductInfo:()=>{$(".dag-shelf-wrapper li[layout] .dag-storefront.main").each(async function(){let o=$(this),e=o.attr("product-id");var t;orionLocalStorage.getItem("dagProductData_"+e)?o.find(".block-btn-promotion.info-discount").addClass("active-info-discount"):(t=(await $.ajax({type:"GET",url:"/api/catalog_system/pub/products/search/?fq=productId:"+e,dataType:"json",contentType:"application/json",headers:{"Content-Type":"application/json",Accept:"application/vnd.vtex.ds.v10+json"}}))[0]).productPbmOn&&t.productPbmOn&&"S"==t.productPbmOn&&(console.log(`Prod: ${t.productId} DENTRO! no programa, Salvando...`),console.log(t),o.find(".block-btn-promotion.info-discount").addClass("active-info-discount"),window.orionLocalStorage.setItem("dagProductData_"+t.productId,JSON.stringify(t),120),t={EAN:t.items[0].ean,requestedQuantity:o.find(".block-buybutton.quantity input").val(),listPrice:t.items[0].sellers[0].commertialOffer.ListPrice,netPrice:t.items[0].sellers[0].commertialOffer.Price,discountType:"B"},console.log(t),i.consultProduct(t))})},consultProduct:o=>{$.cookie("dagInterplayersToken")},verifyToken:()=>{if($.cookie("dagInterplayersToken")){var o=$.cookie("dagInterplayersToken_expiration"),o=new Date(o);if(new Date<o)return void console.log("Token Existe!");console.log("Limpando coockie."),$.removeCookie("dagInterplayersToken"),$.removeCookie("dagInterplayersToken_expiration")}i.getToken()},getToken:()=>{$.ajax({type:"POST",url:i.routes.getToken,data:{Client_Id:"36C0ED06-5F33-448C-96E4-A5AE1AAD3142",Client_Secret:"VP2TQfEL#mF3!rsW",Grant_Type:"client_credentials"}}).done(function(o){i.dataToken=o;let e=i.dateConverterToBrazilTimezone();$.cookie("dagInterplayersToken",o.access_token,{expires:1}),$.cookie("dagInterplayersToken_expiration",e.toString(),{expires:1})})},applyMaskCPF:()=>{$(".block-btn-promotion.input-cpf input").mask("000.000.000-00",{reverse:!0})},buttonsConfigs:()=>{let o=$(".block-btn-promotion.info-discount");$(".dag-storefront-pbm-btn-add"),$(".dag-storefront-pbm-btn-remove"),$(".dag-storefront.pbm-block .box-terms-btn-close"),o.on("click",function(o){o.preventDefault();let e=$(this);e.removeClass("active-info-discount"),e.siblings(".block-btn-promotion.input-cpf").addClass("active-input-cpf")})},consultCPF:()=>{$(".dag-storefront-pbm-btn-add").on("click",function(a){a.preventDefault();let o=$(this),n=o.prev().val(),r=o.attr("field-product-id");if(n.length<14)alert("CPF Incompleto.");else{swal({icon:"https://drogariaglobo.vteximg.com.br/arquivos/drogariaglobo-loading-modal.gif",title:"Consultando...",text:"Por favor não saia ou recarregue a página",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,showCloseButton:!1,showCancelButton:!1,buttons:!1,closeOnClickOutside:!1,didOpen:()=>{Swal.showLoading()}}),n=n.replace(/[^\w\s]/g,"");let o=localStorage.getItem("dagProductData_"+r),e=(o=JSON.parse(o)).items[0].sellers[0].commertialOffer.ListPrice.toString(),t=o.items[0].sellers[0].commertialOffer.Price.toString();e=e.replace(".",""),t=t.replace(".","");a={id:o.productId,packId:0,EAN:o.items[0].ean,requestedQuantity:1,listPrice:e,netPrice:t,discountType:"B"};i.verifyIfUserAcceptTerms(n,a)}})},verifyIfUserAcceptTerms:async(o,e)=>{var o={token:$.cookie("dagInterplayersToken"),control:{clientId:"36C0ED06-5F33-448C-96E4-A5AE1AAD3142",username:"A5FB2147-D606-6DEA-8314-17D5644B19D3",tableId:"37303932-3232-3130-3330-393933333632",localNumber:8888,centralNumber:localStorage.getItem("dagCentralNumber")||0,localHour:"2022-07-29T15:20:51",industryId:"999",stationId:"",companyCode:"99999994001998",attendanceHash:"",terminalId:"ECOMMERCE"},consumer:{holderId:o,cardId:""},product:[e]},e=await i.requestConsultDiscount(o);swal.close(),"H119"==e.returnCode?(console.log("STATUS: H119"),o={url:e.control.urlAcceptTerm,text:e.informativeText},i.showAcceptTermsModal(o)):"Q294"==e.returnCode?(console.log("STATUS: Q294"),localStorage.setItem("dagCentralNumber",e.control.centralNumber),swal({title:"Termos aceitos!",text:"Agora o proximo passo é realizar seu cadastro, redirecionando para o formulario.",icon:"success",closeOnClickOutside:!1}).then(()=>{window.location.pathname="/cadastro-programa"})):"H127"==e.returnCode&&swal({title:"Atenção",text:e.informativeText,icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()})},requestConsultDiscount:o=>$.ajax({type:"POST",url:i.routes.getConsultDiscount,data:o}),showAcceptTermsModal:o=>{var e=`<iframe src="${o.url}"></iframe>`;$(".dag-terms-modal.block-terms-info").html(`<p>${o.text}</p>`),$(".dag-terms-modal.block-terms").html($(e)),$(document.body).addClass("term-modal-on")},closeAcceptModal:()=>{$("#dag-btn-terms-modal-reload").on("click",function(o){o.preventDefault(),$(".dag-terms-modal.block-terms").empty(),$(document.body).removeClass("term-modal-on"),window.location.reload()})},dateConverterToBrazilTimezone:()=>{let o=new Date;var e=(o=new Date(o.getTime()+18e5)).getFullYear().toString()+"-";return(e=(e=(e=(e+=(o.getMonth()+1).toString().padStart(2,"0")+"-")+(o.getDate().toString().padStart(2,"0")+"T"))+(o.getHours().toString().padStart(2,"0")+":"))+(o.getMinutes().toString().padStart(2,"0")+":"))+o.getSeconds().toString().padStart(2,"0")}};$(document).ready(i.init);$(window).load(function(){i.windowOnload()}),$(document).ajaxStop(i.ajaxStop)}catch(o){console.log("Erro na instância do [PBMstorefront]: ",o)}}();