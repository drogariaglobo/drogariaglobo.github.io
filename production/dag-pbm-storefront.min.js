!function(){try{var t="https://drogariaglobo-middleware.herokuapp.com";let i={init:()=>{i.getProductInfo(),i.verifyToken(),i.applyMaskCPF(),i.buttonsConfigs(),i.closeAcceptModal(),i.selectDiscountValue()},windowOnload:()=>{},ajaxStop:()=>{},routes:{getToken:"https://api-mng.interplayers.com.br/gip-scs-svc/token",getConsultDiscount:t+"/dagmiddleware/consult-discount",getConsultProduct:t+"/dagmiddleware/consult-product",getActiveCustomer:"",getProductData:"/api/catalog_system/pub/products/search/?fq=productId:"},getProductInfo:()=>{$(".dag-shelf-wrapper li[layout] .dag-storefront.main").each(async function(){let t=$(this),e=t.attr("product-id");var o;t.is(".pbm-verification-on")||(orionLocalStorage.getItem("dagProductData_"+e)?(t.addClass("pbm-verification-on"),o=localStorage.getItem("dagProductData_"+e),o=JSON.parse(o),i.savingInfosProductsEAN(t,o,e)):(t.addClass("pbm-verification-on"),(o=(await $.ajax({type:"GET",url:"/api/catalog_system/pub/products/search/?fq=productId:"+e,dataType:"json",contentType:"application/json",headers:{"Content-Type":"application/json",Accept:"application/vnd.vtex.ds.v10+json"}}))[0]).productPbmOn&&o.productPbmOn&&"S"==o.productPbmOn&&(window.orionLocalStorage.setItem("dagProductData_"+o.productId,JSON.stringify(o),120),i.savingInfosProductsEAN(t,o,e))))})},savingInfosProductsEAN:async(t,e,o)=>{t.find(".block-btn-promotion.info-discount").addClass("active-info-discount");var n={EAN:e.items[0].ean,requestedQuantity:t.find(".block-buybutton.quantity input").val(),listPrice:e.items[0].sellers[0].commertialOffer.ListPrice,netPrice:e.items[0].sellers[0].commertialOffer.Price,discountType:"B"},a={product:[n],token:$.cookie("dagInterplayersToken")};if(orionLocalStorage.getItem("dagConsultProductData_"+o)){e=localStorage.getItem("dagConsultProductData_"+o),e=JSON.parse(e),e={basePrice:n.netPrice,discountPercentage:e.product[0].discountPercentual,productStore:e.product[0].industryName};i.setBaseDiscount(t,e)}else{const e=await i.requestConsultProduct(a);"N000"==e.returnCode&&(window.orionLocalStorage.setItem("dagConsultProductData_"+o,JSON.stringify(e),120),a={basePrice:n.netPrice,discountPercentage:e.product[0].discountPercentual,productStore:e.product[0].industryName},i.setBaseDiscount(t,a))}},setBaseDiscount:(t,e)=>{var o="0."+e.discountPercentage;o=parseFloat(o);let n=(parseInt(e.basePrice)*o).toFixed(2);n=n.replace(".",","),t.find(".pbm-price").text("R$ "+n)},requestConsultProduct:t=>$.ajax({type:"POST",url:i.routes.getConsultProduct,data:t}),verifyToken:()=>{if($.cookie("dagInterplayersToken")){var t=$.cookie("dagInterplayersToken_expiration"),t=new Date(t);if(new Date<t)return void console.log("Token Existe!");console.log("Limpando coockie."),$.removeCookie("dagInterplayersToken"),$.removeCookie("dagInterplayersToken_expiration")}i.getToken()},getToken:()=>{$.ajax({type:"POST",url:i.routes.getToken,data:{Client_Id:"36C0ED06-5F33-448C-96E4-A5AE1AAD3142",Client_Secret:"VP2TQfEL#mF3!rsW",Grant_Type:"client_credentials"}}).done(function(t){i.dataToken=t;let e=i.dateConverterToBrazilTimezone(!0);$.cookie("dagInterplayersToken",t.access_token,{expires:1}),$.cookie("dagInterplayersToken_expiration",e.toString(),{expires:1})})},applyMaskCPF:()=>{$(".block-btn-promotion.input-cpf input").mask("000.000.000-00",{reverse:!0})},buttonsConfigs:()=>{let t=$(".block-btn-promotion.info-discount"),e=$(".dag-storefront-pbm-btn-add"),o=$(".dag-storefront-pbm-btn-remove"),n=$(".dag-storefront.pbm-block .box-terms-btn-close"),a=$(".box-unitys-products--remove");t.on("click",function(t){t.preventDefault();let e=$(this),o=e.closest(".dag-storefront.main");i.functionsShowStepsPbm.showFieldCPF(e,o)}),e.on("click",function(t){t.preventDefault();let e=$(this),o=e.prev().val(),n=e.attr("field-product-id");o.length<14?alert("CPF Incompleto."):i.doIntegration(o,n)}),o.on("click",function(t){t.preventDefault();let e=$(this).closest(".dag-storefront.main");e.addClass("pbm-loader-on"),e.find(".dag-storefront.content").hide(),e.find(".dag-storefront.discount-loader").addClass("active-loader-pbm"),setTimeout(function(){e.find(".block-btn-promotion.discount-applied").removeClass("active-discount-applied"),e.find(".block-btn-promotion.info-discount").addClass("active-info-discount"),e.removeClass("pbm-loader-on"),e.find(".dag-storefront.discount-loader").removeClass("active-loader-pbm"),e.find(".dag-storefront.content").show()},2e3)}),n.on("click",function(t){t.preventDefault();let e=$(this).closest(".dag-storefront.pbm-block");e.find(".box-terms-register, .box-term-autorize").removeClass("active-box-terms-register active-box-terms-autorize"),e.find(".block-btn-promotion.info-discount").addClass("active-info-discount")}),a.on("click",function(t){t.preventDefault();let e=$(this).closest(".dag-storefront.main");e.find(".dag-storefront.pbm-block").removeClass("box-unity-on"),e.find(".block-btn-promotion.info-discount").addClass("active-info-discount")})},doIntegration:(t,e)=>{swal({icon:"https://drogariaglobo.vteximg.com.br/arquivos/drogariaglobo-loading-modal.gif",title:"Consultando...",text:"Por favor não saia ou recarregue a página",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,showCloseButton:!1,showCancelButton:!1,buttons:!1,closeOnClickOutside:!1,didOpen:()=>{Swal.showLoading()}}),t=t.replace(/[^\w\s]/g,"");let o=localStorage.getItem("dagProductData_"+e);var e=(o=JSON.parse(o)).items[0].sellers[0].commertialOffer.ListPrice.toString().replace(".",""),n=o.items[0].sellers[0].commertialOffer.Price.toString().replace(".",""),e={id:o.productId,packId:0,EAN:o.items[0].ean,requestedQuantity:1,listPrice:e,netPrice:n,discountType:"B"},n=(window.orionLocalStorage.setItem("dagProductInfoPrices_"+o.productId,JSON.stringify(e),120),{id:o.productId,EAN:o.items[0].ean,requestedQuantity:1});window.orionLocalStorage.setItem("dagProductInfoEAN_"+o.productId,JSON.stringify(n),120),i.integrationStepsConsult(t,e)},integrationStepsConsult:async(t,e)=>{var o,t={token:$.cookie("dagInterplayersToken"),control:{clientId:"36C0ED06-5F33-448C-96E4-A5AE1AAD3142",username:"A5FB2147-D606-6DEA-8314-17D5644B19D3",tableId:"37303932-3232-3130-3330-393933333632",localNumber:8888,centralNumber:localStorage.getItem("dagCentralNumber")||0,localHour:i.dateConverterToBrazilTimezone(null),industryId:"999",stationId:"",companyCode:"99999994001998",attendanceHash:"",terminalId:"ECOMMERCE"},consumer:{holderId:t,cardId:""},product:[e]},t=await i.requestConsultDiscount(t);swal.close(),"H119"==t.returnCode?(console.log("STATUS: H119"),o={url:t.control.urlAcceptTerm,text:t.informativeText},i.showAcceptTermsModal(o)):"Q294"==t.returnCode?(console.log("STATUS: Q294"),localStorage.setItem("dagCentralNumber",t.control.centralNumber),swal({title:"Termos aceitos!",text:"Agora o proximo passo é realizar seu cadastro, redirecionando para o formulario.",icon:"success",closeOnClickOutside:!1}).then(()=>{window.location.pathname="/cadastro-programa"})):"H127"==t.returnCode?swal({title:"Atenção",text:t.informativeText,icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()}):"N000"==t.returnCode&&i.showPBMproductsDiscounts(e.id,t)},requestConsultDiscount:t=>$.ajax({type:"POST",url:i.routes.getConsultDiscount,data:t}),showAcceptTermsModal:t=>{var e=`<iframe src="${t.url}"></iframe>`;$(".dag-terms-modal.block-terms-info").html(`<p>${t.text}</p>`),$(".dag-terms-modal.block-terms").html($(e)),$(document.body).addClass("term-modal-on")},showPBMproductsDiscounts:(r,t)=>{let e=t.product,s="",o=(e.forEach(t=>{let e=$(`.dag-storefront.main[product-id="${r}"]`),o=e.find(".prices.best-price strong").text();e.find(".box-unitys-current-price--value").text(o);var n=localStorage.getItem("dagConsultProductData_"+r),n=JSON.parse(n).product[0].industryName;e.find(".box-unitys-inputs > span").text(n);let a=parseInt(t.discountValue);a=a.toLocaleString("pt-br",{style:"currency",currency:"BRL"});n=`<div class="box-unitys-inputs-prices"><span class="box-unitys-inputs-prices--check"></span><span class="box-unitys-inputs-prices--unity">${t.authorizedQuantity} UN.</span><span class="box-unitys-inputs-prices--value">${a}</span></div>`;s+=n}),$(`.dag-storefront.main[product-id="${r}"]`));o.find(".box-unitys-inputs-wrapper").html(s),i.functionsShowStepsPbm.showProductsDiscounts(o)},closeAcceptModal:()=>{$("#dag-btn-terms-modal-reload").on("click",function(t){t.preventDefault(),$(".dag-terms-modal.block-terms").empty(),$(document.body).removeClass("term-modal-on"),window.location.reload()})},selectDiscountValue:()=>{var t=$(".box-unitys-inputs-prices--check");$(document).on("click",t,function(t){t.preventDefault(),t.stopPropagation(),$(t.target).is(".box-unitys-inputs-prices--check")&&(i.loading(),$(t.target).addClass("block-input"),$(t.target).parent().parent().find(".box-unitys-inputs-prices--check").addClass("block-input"),$(t.target).parent().siblings().removeClass("discount-selected"),$(t.target).parent().addClass("discount-selected"),setTimeout(function(){$(t.target).removeClass("block-input"),$(t.target).parent().parent().find(".box-unitys-inputs-prices--check").removeClass("block-input")},5e3))})},functionsShowStepsPbm:{showDefault:function(){elem.find(".block-btn-promotion.discount-applied").addClass("active-discount-applied"),elem.find(".block-btn-promotion.input-cpf").removeClass("active-input-cpf"),elem.find(".dag-storefront.discount-loader").removeClass("active-loader-pbm"),elem.removeClass("pbm-loader-on"),elem.find(".dag-storefront.content").show()},showFieldCPF:function(t){t.removeClass("active-info-discount"),t.siblings(".block-btn-promotion.input-cpf").addClass("active-input-cpf")},showRegister:function(){elem.find(".pbm-block.box-terms-register").addClass("active-box-terms-register"),elem.find(".block-btn-promotion.input-cpf").removeClass("active-input-cpf"),elem.find(".dag-storefront.discount-loader").removeClass("active-loader-pbm"),elem.removeClass("pbm-loader-on"),elem.find(".dag-storefront.content").addClass("content-on")},showTerms:function(){elem.find(".pbm-block.box-term-autorize").addClass("active-box-terms-autorize"),elem.find(".block-btn-promotion.input-cpf").removeClass("active-input-cpf"),elem.find(".dag-storefront.discount-loader").removeClass("active-loader-pbm"),elem.removeClass("pbm-loader-on"),elem.find(".dag-storefront.content").addClass("content-on")},showProductsDiscounts:function(t){t.find(".block-btn-promotion.input-cpf").removeClass("active-input-cpf"),t.find(".dag-storefront.pbm-block").addClass("box-unity-on")},showActivedDiscountSeted:function(){}},loading:()=>{swal({icon:"https://drogariaglobo.vteximg.com.br/arquivos/drogariaglobo-loading-modal.gif",title:"Consultando...",text:"Por favor não saia ou recarregue a página",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,showCloseButton:!1,showCancelButton:!1,buttons:!1,closeOnClickOutside:!1,didOpen:()=>{Swal.showLoading()}})},dateConverterToBrazilTimezone:t=>{let e=new Date;t=(e=t?new Date(e.getTime()+18e5):e).getFullYear().toString()+"-";return(t=(t=(t=(t+=(e.getMonth()+1).toString().padStart(2,"0")+"-")+(e.getDate().toString().padStart(2,"0")+"T"))+(e.getHours().toString().padStart(2,"0")+":"))+(e.getMinutes().toString().padStart(2,"0")+":"))+e.getSeconds().toString().padStart(2,"0")}};$(document).ready(i.init);$(window).load(function(){i.windowOnload()}),$(document).ajaxStop(i.ajaxStop)}catch(t){console.log("Erro na instância do [PBMstorefront]: ",t)}}();