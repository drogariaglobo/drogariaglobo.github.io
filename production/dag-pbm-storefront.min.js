!function(){try{var t="https://drogariaglobo-middleware.herokuapp.com";let d={init:()=>{d.verifyToken(),d.getProductInfo(),d.applyMaskCPF(),d.pbmAllEvents(),d.closeAcceptModal(),d.selectDiscountValue()},windowOnload:()=>{},ajaxStop:()=>{},routes:{getToken:"https://api-mng.interplayers.com.br/gip-scs-svc/token",getConsultDiscount:t+"/dagmiddleware/consult-discount",getConsultProduct:t+"/dagmiddleware/consult-product",getCart:t+"/dagmiddleware/cart",getActiveCustomer:"",getProductData:"/api/catalog_system/pub/products/search/?fq=productId:"},verifyToken:async()=>{if($.cookie("dagInterplayersToken")){var e=$.cookie("dagInterplayersToken_expiration"),e=new Date(e);if(new Date<e)return void console.log("Token ativo.");$.removeCookie("dagInterplayersToken"),$.removeCookie("dagInterplayersToken_expiration")}e=await d.requestGenerateToken();if(e&&e.access_token){console.log("Novo token"),d.dataToken=e;let t=d.dateConverterToBrazilTimezone(!0);$.cookie("dagInterplayersToken",e.access_token,{expires:1}),$.cookie("dagInterplayersToken_expiration",t.toString(),{expires:1})}},getProductInfo:()=>{$(".dag-shelf-wrapper li[layout] .dag-storefront.main").each(async function(){let t=$(this),e=t.attr("product-id");var o;t.is(".pbm-verification-on")||(orionLocalStorage.getItem("dagProductData_"+e)?(t.addClass("pbm-verification-on"),orionLocalStorage.getItem("dagProductInCart_"+e)?(o=localStorage.getItem("dagConsultProductData_"+e),o=JSON.parse(o),d.functionsShowStepsPbm.showActivedDiscountSeted(t,o.product[0].industryName)):(o=localStorage.getItem("dagProductData_"+e),o=JSON.parse(o),d.savingInfosProductsEAN(t,o,e))):(t.addClass("pbm-verification-on"),(o=(await $.ajax({type:"GET",url:"/api/catalog_system/pub/products/search/?fq=productId:"+e,dataType:"json",contentType:"application/json",headers:{"Content-Type":"application/json",Accept:"application/vnd.vtex.ds.v10+json"}}))[0]).productPbmOn&&o.productPbmOn&&"S"==o.productPbmOn&&(window.orionLocalStorage.setItem("dagProductData_"+o.productId,JSON.stringify(o),120),d.savingInfosProductsEAN(t,o,e))))})},savingInfosProductsEAN:async(t,e,o)=>{t.find(".block-btn-promotion.info-discount").addClass("active-info-discount");var n={EAN:e.items[0].ean,requestedQuantity:t.find(".block-buybutton.quantity input").val(),listPrice:e.items[0].sellers[0].commertialOffer.ListPrice,netPrice:e.items[0].sellers[0].commertialOffer.Price,discountType:"L"},a={product:[n],token:$.cookie("dagInterplayersToken")};if(orionLocalStorage.getItem("dagConsultProductData_"+o)){e=localStorage.getItem("dagConsultProductData_"+o),e=JSON.parse(e),e={basePrice:n.netPrice,discountPercentage:e.product[0].discountPercentual,productStore:e.product[0].industryName};d.setBaseDiscount(t,e)}else{const e=await d.requestConsultProduct(a);"N000"==e.returnCode&&(window.orionLocalStorage.setItem("dagConsultProductData_"+o,JSON.stringify(e),120),a={basePrice:n.netPrice,discountPercentage:e.product[0].discountPercentual,productStore:e.product[0].industryName},d.setBaseDiscount(t,a))}},setBaseDiscount:(t,e)=>{var o="0."+e.discountPercentage;o=parseFloat(o);let n=(parseInt(e.basePrice)*o).toFixed(2);n=n.replace(".",","),t.find(".pbm-price").attr("data-price","R$ "+n),t.find(".pbm-price").text("R$ "+n)},applyMaskCPF:()=>{$(".block-btn-promotion.input-cpf input").mask("000.000.000-00",{reverse:!0})},pbmAllEvents:()=>{let t=$(".block-btn-promotion.info-discount"),e=$(".dag-storefront-pbm-btn-add"),o=$(".dag-storefront-pbm-btn-remove"),n=$(".dag-storefront.pbm-block .box-terms-btn-close"),a=$(".box-unitys-products--remove");t.on("click",function(t){t.preventDefault();let e=$(this),o=e.closest(".dag-storefront.main");d.functionsShowStepsPbm.showFieldCPF(e,o)}),e.on("click",function(t){t.preventDefault();let e=$(this),o=e.prev().val(),n=e.attr("field-product-id");o.length<14?alert("CPF Incompleto."):(localStorage.removeItem("dagCurrentListProductsDiscounts"),d.doIntegration(o,n))}),o.on("click",function(t){t.preventDefault();let e=$(this),o=e.attr("product-id"),n=e.closest(".dag-storefront.main");n.addClass("pbm-loader-on"),n.find(".dag-storefront.content").hide(),n.find(".dag-storefront.discount-loader").addClass("active-loader-pbm"),localStorage.removeItem("dagProductInCart_"+o),localStorage.removeItem("dagProductInCart_"+o+"_expiration"),setTimeout(function(){n.find(".block-btn-promotion.discount-applied").removeClass("active-discount-applied"),n.find(".block-btn-promotion.info-discount").addClass("active-info-discount"),n.removeClass("pbm-loader-on"),n.find(".dag-storefront.discount-loader").removeClass("active-loader-pbm"),n.find(".dag-storefront.content").show(),location.reload()},2e3)}),n.on("click",function(t){t.preventDefault();let e=$(this).closest(".dag-storefront.pbm-block");e.find(".box-terms-register, .box-term-autorize").removeClass("active-box-terms-register active-box-terms-autorize"),e.find(".block-btn-promotion.info-discount").addClass("active-info-discount")}),a.on("click",function(t){t.preventDefault();let e=$(this).closest(".dag-storefront.main");e.find(".dag-storefront.pbm-block").removeClass("box-unity-on"),e.find(".block-btn-promotion.info-discount").addClass("active-info-discount")})},doIntegration:(t,e)=>{d.loading(),t=t.replace(/[^\w\s]/g,"");let o=localStorage.getItem("dagProductData_"+e);var e=(o=JSON.parse(o)).items[0].sellers[0].commertialOffer.ListPrice.toString().replace(".",""),n=o.items[0].sellers[0].commertialOffer.Price.toString().replace(".",""),e={id:o.productId,packId:0,EAN:o.items[0].ean,requestedQuantity:1,listPrice:e,netPrice:n,discountType:"L"},n=(window.orionLocalStorage.setItem("dagProductInfoPrices_"+o.productId,JSON.stringify(e),120),window.orionLocalStorage.setItem("dagCurrentProduct",JSON.stringify({id:o.productId,EAN:o.items[0].ean,requestQuantity:1}),120),{id:o.productId,EAN:o.items[0].ean,requestedQuantity:1});window.orionLocalStorage.setItem("dagProductInfoEAN_"+o.productId,JSON.stringify(n),120),d.integrationStepsConsult(t,e)},integrationStepsConsult:async(t,e)=>{var o,n={token:$.cookie("dagInterplayersToken"),control:{clientId:"36C0ED06-5F33-448C-96E4-A5AE1AAD3142",username:"A5FB2147-D606-6DEA-8314-17D5644B19D3",tableId:"37303932-3232-3130-3330-393933333632",localNumber:8888,centralNumber:localStorage.getItem("dagCentralNumber")||0,localHour:d.dateConverterToBrazilTimezone(null),industryId:"999",stationId:"",companyCode:"99999994001998",attendanceHash:"",terminalId:"ECOMMERCE"},consumer:{holderId:t,cardId:""},product:[e]},n=await d.requestConsultDiscount(n);swal.close(),"H119"==n.returnCode?(console.log("STATUS: H119"),o={url:n.control.urlAcceptTerm,text:n.informativeText},console.log(o),d.showAcceptTermsModal(o)):"Q294"==n.returnCode?(console.log("STATUS: Q294"),localStorage.setItem("dagCentralNumber",n.control.centralNumber),swal({title:"Termos aceitos!",text:"Agora o proximo passo é realizar seu cadastro, redirecionando para o formulario.",icon:"success",closeOnClickOutside:!1}).then(()=>{window.location.pathname="/cadastro-programa"})):"H127"==n.returnCode?swal({title:"Atenção",text:n.informativeText,icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()}):"N000"==n.returnCode?(window.orionLocalStorage.setItem("dagUserCPF",t,120),window.orionLocalStorage.setItem("dagCurrentListProductsDiscounts",JSON.stringify(n),120),d.showPBMproductsDiscounts(e.id,n)):n&&401==n.status&&swal({title:"Atenção",text:"Navegação expirada. Gerando um novo token.",icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()})},showAcceptTermsModal:t=>{var e=`<iframe src="${t.url}"></iframe>`;$(".dag-terms-modal.block-terms-info").html(`<p>${t.text}</p>`),$(".dag-terms-modal.block-terms").html($(e)),$(document.body).addClass("term-modal-on")},showPBMproductsDiscounts:(i,t)=>{let e=t.product,s="",o=(e.forEach((t,e)=>{let o=$(`.dag-storefront.main[product-id="${i}"]`),n=o.find(".prices.best-price strong").text();o.find(".box-unitys-current-price--value").text(n);var a=localStorage.getItem("dagConsultProductData_"+i),a=JSON.parse(a).product[0].industryName;o.find(".box-unitys-inputs > span").text(a);let r=parseInt(t.discountValue);r=r.toLocaleString("pt-br",{style:"currency",currency:"BRL"});a=`<div class="box-unitys-inputs-prices"><span class="box-unitys-inputs-prices--check" product-id="${i}" data-index="${e}"></span><span class="box-unitys-inputs-prices--unity">${t.authorizedQuantity} UN.</span><span class="box-unitys-inputs-prices--value">${r}</span></div>`;s+=a}),$(`.dag-storefront.main[product-id="${i}"]`));o.find(".box-unitys-inputs-wrapper").html(s),d.functionsShowStepsPbm.showProductsDiscounts(o)},closeAcceptModal:()=>{$("#dag-btn-terms-modal-reload").on("click",function(t){t.preventDefault(),$(".dag-terms-modal.block-terms").empty(),$(document.body).removeClass("term-modal-on"),window.location.reload()})},selectDiscountValue:()=>{var t=$(".box-unitys-inputs-prices--check");$(document).on("click",t,function(a){if(a.preventDefault(),a.stopPropagation(),$(a.target).is(".box-unitys-inputs-prices--check")){d.loading();let t=$(a.target),e=t.attr("product-id"),o=$(`.dag-storefront.main[product-id="${e}"]`),n=t.attr("data-index");d.sendProductToCartInterplayers(e,n,o)}})},sendProductToCartInterplayers:async(t,o,e)=>{let n=localStorage.getItem("dagProductInfoPrices_"+t),a=localStorage.getItem("dagCurrentListProductsDiscounts"),r=(n=JSON.parse(n),a=JSON.parse(a),null);a.product.forEach((t,e)=>{e==o&&(r=a.product[e])}),n.requestedQuantity=r.authorizedQuantity,e.find(".dag-storefront-pbm-quantity").val(n.requestedQuantity);var e={cpf:localStorage.getItem("dagUserCPF"),token:$.cookie("dagInterplayersToken"),product:n},e=await d.requestSendProductCart(e);swal.close(),"N000"==e.returnCode&&(e={productId:t,transactionCode:e.transaction.transactionCode},window.orionLocalStorage.setItem("dagProductInCart_"+t,JSON.stringify(e),120),window.location.reload())},requestGenerateToken:()=>$.ajax({type:"POST",url:d.routes.getToken,data:{Client_Id:"36C0ED06-5F33-448C-96E4-A5AE1AAD3142",Client_Secret:"VP2TQfEL#mF3!rsW",Grant_Type:"client_credentials"}}),requestConsultProduct:t=>$.ajax({type:"POST",url:d.routes.getConsultProduct,data:t}),requestConsultDiscount:t=>$.ajax({type:"POST",url:d.routes.getConsultDiscount,data:t}),requestSendProductCart:t=>$.ajax({type:"POST",url:d.routes.getCart,data:t}),functionsShowStepsPbm:{showDefault:function(){elem.find(".block-btn-promotion.discount-applied").addClass("active-discount-applied"),elem.find(".block-btn-promotion.input-cpf").removeClass("active-input-cpf"),elem.find(".dag-storefront.discount-loader").removeClass("active-loader-pbm"),elem.removeClass("pbm-loader-on"),elem.find(".dag-storefront.content").show()},showFieldCPF:function(t){t.removeClass("active-info-discount"),t.siblings(".block-btn-promotion.input-cpf").addClass("active-input-cpf")},showRegister:function(){elem.find(".pbm-block.box-terms-register").addClass("active-box-terms-register"),elem.find(".block-btn-promotion.input-cpf").removeClass("active-input-cpf"),elem.find(".dag-storefront.discount-loader").removeClass("active-loader-pbm"),elem.removeClass("pbm-loader-on"),elem.find(".dag-storefront.content").addClass("content-on")},showTerms:function(){elem.find(".pbm-block.box-term-autorize").addClass("active-box-terms-autorize"),elem.find(".block-btn-promotion.input-cpf").removeClass("active-input-cpf"),elem.find(".dag-storefront.discount-loader").removeClass("active-loader-pbm"),elem.removeClass("pbm-loader-on"),elem.find(".dag-storefront.content").addClass("content-on")},showProductsDiscounts:function(t){t.find(".block-btn-promotion.input-cpf").removeClass("active-input-cpf"),t.find(".dag-storefront.pbm-block").addClass("box-unity-on")},showActivedDiscountSeted:function(t,e){t.find(".pbm-discount-applied-text").text(e),t.find(".block-btn-promotion.info-discount").removeClass("active-info-discount"),t.find(".block-btn-promotion.discount-applied").addClass("active-discount-applied")}},hideOthersDefaultsDiscounts:t=>{t.attr("product-id"),$(".dag-shelf-wrapper li[layout] .dag-storefront.main").find(".block-btn-promotion.info-discount").not(t)},loading:()=>{swal({icon:"https://drogariaglobo.vteximg.com.br/arquivos/drogariaglobo-loading-modal.gif",title:"Consultando...",text:"Por favor não saia ou recarregue a página",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,showCloseButton:!1,showCancelButton:!1,buttons:!1,closeOnClickOutside:!1,didOpen:()=>{Swal.showLoading()}})},dateConverterToBrazilTimezone:t=>{let e=new Date;t=(e=t?new Date(e.getTime()+18e5):e).getFullYear().toString()+"-";return(t=(t=(t=(t+=(e.getMonth()+1).toString().padStart(2,"0")+"-")+(e.getDate().toString().padStart(2,"0")+"T"))+(e.getHours().toString().padStart(2,"0")+":"))+(e.getMinutes().toString().padStart(2,"0")+":"))+e.getSeconds().toString().padStart(2,"0")}};$(document).ready(d.init);$(window).load(function(){d.windowOnload()}),$(document).ajaxStop(d.ajaxStop)}catch(t){console.log("Erro na instância do [PBMstorefront]: ",t)}}();