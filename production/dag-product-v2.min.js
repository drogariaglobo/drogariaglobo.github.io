!function(){try{var e="https://drogariaglobo-middleware.herokuapp.com";let l={init:()=>{l.applyMaskCPF(),l.verifyStatusDiscount(),l.getProductData(),l.pbmAllEvents(),l.closeAcceptModal(),l.applySelectedDiscount(),l.removeDiscountApplied(),l.applyDefaultsBuybutton()},windowOnload:()=>{},ajaxStop:()=>{},pbmSpecData:null,pbmTypeField:null,routes:{prodData:"/api/catalog_system/pub/products/search/?fq=productId:",getListDiscounts:e+"/middleware/v1/prices-discounts",getCart:e+"/middleware/v1/cart",changePrice:e+"/middleware/v1/change-price-vtex"},verifyStatusDiscount:()=>{orionLocalStorage.getItem("dagCurrentCart")&&JSON.parse(localStorage.getItem("dagCurrentCart")).consultList.find(e=>e.id==skuJson.productId)?($(".product-right__buy-button").hide(),$(".pbm-discount-activated").addClass("discount-activated-on"),l.lockingDefaultBuyButtons()):$(".pbm-standard-discount").addClass("standard-discount-on")},getProductData:async()=>{var e=await l.requestProductData();l.data=e[0],l.checkingIfHasPBM(l.data)},checkingIfHasPBM:t=>{var o=skuJson.productId;if(t.productId==o)if(t.productPbmOn&&t.productPbmOn&&"S"==t.productPbmOn)if(t.formattedPrice&&t.standardPrice){let e=t.items[0].sellers[0].commertialOffer;l.pbmSpecData={requestHolderId:t.requestHolderId[0],productPbmOn:t.productPbmOn[0],requestCoupon:t.requestCoupon[0],eanCombos:t.eanCombos[0],industryName:t.industryName[0],todayTableId:t.todayTableId[0],formattedPrice:t.formattedPrice[0],standardPrice:t.standardPrice[0],listPrice:e.ListPrice.toFixed(2),netPrice:e.PriceWithoutDiscount.toFixed(2),baseListPrice:e.ListPrice.toFixed(2).toString().replace(".",""),baseNetPrice:e.PriceWithoutDiscount.toFixed(2).toString().replace(".",""),discountType:t.discountType[0],quantity:e.AvailableQuantity,seller:t.items[0].sellers[0].sellerId},localStorage.setItem("dagDataProduct",JSON.stringify(l.pbmSpecData)),"M"==l.pbmSpecData.requestHolderId&&"O"==l.pbmSpecData.requestCoupon?(l.pbmTypeField=1,localStorage.getItem("dagUserCPF")&&(o=localStorage.getItem("dagUserCPF"),$("#pbm-first-rule-cpf").val(o))):"M"==l.pbmSpecData.requestHolderId&&"M"==l.pbmSpecData.requestCoupon?(l.pbmTypeField=2,localStorage.getItem("dagUserCPF")&&(t=localStorage.getItem("dagUserCPF"),$("#pbm-second-rule-cpf").val(t)),localStorage.getItem("dagUserCard")&&(o=localStorage.getItem("dagUserCard"),$(".pbm-card-field").val(o))):"X"==l.pbmSpecData.requestHolderId&&"M"==l.pbmSpecData.requestCoupon&&(l.pbmTypeField=3,localStorage.getItem("dagUserCard"))&&(t=localStorage.getItem("dagUserCard"),$(".pbm-card-field").val(t)),$(".pbm-prod-price").text(l.pbmSpecData.standardPrice),$(".pbm-prod-discount-activated-text").text(l.pbmSpecData.industryName)}else $(".dag-product.pbm").hide();else $(".dag-product.pbm").hide()},pbmAllEvents:()=>{$(".pbm-standard-discount").on("click",function(e){e.preventDefault(),1==l.pbmTypeField?(l.pbmFront.showDefaultDiscount.hide(),$(".pbm-first-rule").addClass("pbm-first-rule-on")):2==l.pbmTypeField?(l.pbmFront.showDefaultDiscount.hide(),$(".pbm-second-rule").addClass("pbm-second-rule-on")):3==l.pbmTypeField&&(l.pbmFront.showDefaultDiscount.hide(),$(".pbm-third-rule").addClass("pbm-third-rule-on"))}),$(".pbm-list-discounts-finded--remove").on("click",function(e){e.preventDefault(),$(".pbm-cpf-field").val(""),1==l.pbmTypeField?l.pbmFront.showRules.hideFirstRule():2==l.pbmTypeField?l.pbmFront.showRules.hideSecondRule():3==l.pbmTypeField&&l.pbmFront.showRules.hideThirdRule(),l.pbmFront.showListDiscountsPrices.hide(),l.pbmFront.showDefaultDiscount.show()}),$(".pbm-add-button").on("click",function(e){e.preventDefault();let t=null,o=null;if(1==l.pbmTypeField){if((t=$("#pbm-first-rule-cpf").val()).length<11)return void alert("CPF Incompleto. [1]");if(localStorage.removeItem("dagUserCard"),localStorage.getItem("dagUserForm")){let e=JSON.parse(localStorage.getItem("dagUserForm"));e.cardId="",window.orionLocalStorage.setItem("dagCurrentProductPBM",JSON.stringify(e),120)}l.pbmFront.showRules.hideFirstRule()}else if(2==l.pbmTypeField){if(t=$("#pbm-second-rule-cpf").val(),o=$("#pbm-second-rule-card").val(),t.length<11)return void alert("CPF Incompleto. [2]");if(0==o.length)return void alert("O Nº do cartão é obrigatório. [1]");l.pbmFront.showRules.hideSecondRule()}else if(3==l.pbmTypeField){if(0==(o=$("#pbm-third-rule-card").val()).length)return void alert("O Nº do cartão é obrigatório. [2]");localStorage.removeItem("dagUserCPF"),l.pbmFront.showRules.hideThirdRule()}if(l.pbmFront.showLoading.show(),t&&(t.match(/[^\w\s]/g)&&(t=t.replace(/[^\w\s]/g,"")),window.orionLocalStorage.setItem("dagUserCPF",t,120)),o&&window.orionLocalStorage.setItem("dagUserCard",o,120),localStorage.getItem("dagUserForm")){let e=JSON.parse(localStorage.getItem("dagUserForm"));e.holderId!=t&&(e.holderId=t),localStorage.setItem("dagUserForm",JSON.stringify(e))}e={id:l.data.productId,packId:0,EAN:l.data.items[0].ean,requestedQuantity:1,pricesOriginal:{listPrice:l.pbmSpecData.listPrice,netPrice:l.pbmSpecData.netPrice},pricesFormatted:{listPrice:l.pbmSpecData.baseListPrice,netPrice:l.pbmSpecData.baseNetPrice},discountType:l.pbmSpecData.discountType,tableId:l.pbmSpecData.todayTableId};window.orionLocalStorage.setItem("dagCurrentProductPBM",JSON.stringify(e),120),l.consultDiscountIntegration(t,o,e)})},consultDiscountIntegration:async(e,t,o)=>{e={cpf:e,card:t,product:o},t=await l.requestListDiscounts(e);"H119"==t.responseCode||"H120"==t.responseCode?(l.pbmFront.showLoading.hide(),o={url:t.urlTerms,text:t.message},l.showAcceptTermsModal(o)):"Q291"==t.responseCode||"Q292"==t.responseCode||"Q293"==t.responseCode||"Q294"==t.responseCode||"Q295"==t.responseCode?(l.pbmFront.showLoading.hide(),localStorage.setItem("dagCentralNumber",t.centralNumber),swal({title:"Termos aceitos!",text:t.message,icon:"success",closeOnClickOutside:!1}).then(()=>{window.location.pathname="/cadastro-programa"})):"H127"==t.responseCode?(l.pbmFront.showLoading.hide(),swal({title:"Atenção",text:"Este canal não permite adesão. Faça a adesão através do 0800 707 1080 ou www.valemaissaude.com.br.",icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()})):"N000"==t.responseCode||"W003"==t.responseCode?(l.renderListDiscountsPrices(t.listPrices),l.pbmFront.showLoading.hide(),l.pbmFront.showListDiscountsPrices.show()):"F803"==t.responseCode||"Q027"==t.responseCode||"Q710"==t.responseCode||"Q542"==t.responseCode?(l.pbmFront.showLoading.hide(),swal({title:"Atenção",text:t.message,icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()})):t&&t.interplayersError&&l.interplayersErrors(t)},renderListDiscountsPrices:e=>{let t=$(".pbm-list-discounts-prices-wrapper"),o=$(".pbm-list-discounts-finded--value"),a=$(".pbm-list-discounts-current-price--value"),r="",s=!1;e.forEach(function(e){"0"==e.discountValue&&(s=!0);e=`
                        <div class="pbm-list-discounts-prices" data-price="${e.price}" data-price-interger="${e.priceInteger}" data-quantity="${e.quantity}">
                            <span class="pbm-list-discounts-prices--check"></span>
                            <span class="pbm-list-discounts-prices--unity">${e.quantity} UN.</span>
                            <span class="pbm-list-discounts-prices--value">${e.priceFormatted}</span>
                        </div>`;r+=e}),1==e.length?o.text(e.length+" desconto"):o.text(e.length+" descontos");e=$(".skuBestPrice").text();a.text(e),t.html(r),1==s&&($(".pbm-description-title").text("Desconto da loja"),$(".pbm-description-text").text("Melhor desconto da loja aplicado.")),l.applySelectFieldsDiscounts()},applySelectFieldsDiscounts:()=>{$(".pbm-list-discounts-prices-wrapper .pbm-list-discounts-prices").on("click",function(e){e.preventDefault();let t=$(this);t.siblings().removeClass("price-discount-selected"),t.addClass("price-discount-selected")})},applySelectedDiscount:()=>{$("#pbm-btn-apply-discount").on("click",async function(n){if(n.preventDefault(),$(".pbm-list-discounts-prices-wrapper .pbm-list-discounts-prices").is(".price-discount-selected")){l.pbmFront.showListDiscountsPrices.hide(),l.pbmFront.showLoading.show();let e=$(".pbm-list-discounts-prices.price-discount-selected"),t=e.attr("data-price-interger"),a=e.attr("data-quantity"),r=localStorage.getItem("dagCurrentProductPBM"),o=((r=JSON.parse(r)).requestedQuantity=a,$(".pbm-list-discounts-prices").last()),s=(o=o.attr("data-quantity"),l.pbmSpecData.quantity<r.requestedQuantity&&(a=l.pbmSpecData.quantity,r.requestedQuantity=l.pbmSpecData.quantity,alert(`Alerta! A quantidade do produto dentro da loja é menor que a quantidade selecionada. Será adicionado a quantidade disponivel do produto ao seu carrinho. Quantidade: ${l.pbmSpecData.quantity}.`)),[]);(orionLocalStorage.getItem("dagCurrentCart")?s=JSON.parse(localStorage.getItem("dagCurrentCart")).consultList:s).push(r);var i={cpf:localStorage.getItem("dagUserCPF")||null,card:localStorage.getItem("dagUserCard")||null,consultList:s,tableId:l.pbmSpecData.todayTableId};const d=await l.requestSendProductCart(i);if("N000"==d.returnCode){if(console.log("Sucesso na adesão!"),1==s.length){console.log("1 Produto adicionado.");i={cpf:localStorage.getItem("dagUserCPF")||null,card:localStorage.getItem("dagUserCard")||null,consultList:s,responseCart:d},i=(window.orionLocalStorage.setItem("dagCurrentCart",JSON.stringify(i),120),window.orionLocalStorage.setItem("dagCurrentProductPBM",JSON.stringify(r),120),{id:r.id,qtt:a,price:t});try{l.addProductInCartPBM(i)}catch(n){console.log("Erro ao adicionar o produto ao carrinho"),console.log(n.message),window.location.reload()}}else if(1<s.length){console.log("Mais de 1 produto.");let o=d.product.filter(e=>41==e.status);if(console.log("Produto Limitado."),console.log(o),o&&o.length){console.log("Produto com saldo limite localizado!");let t=[];s.forEach(e=>{parseInt(e.id)!=o[0].id&&t.push(e)});i={cpf:localStorage.getItem("dagUserCPF")||null,card:localStorage.getItem("dagUserCard")||null,consultList:t,responseCart:d};window.orionLocalStorage.setItem("dagCurrentCart",JSON.stringify(i),120),window.orionLocalStorage.setItem("dagCurrentProductPBM",JSON.stringify(r),120);try{l.addProductInCartDefault(a)}catch(n){console.log("Erro ao adicionar o produto ao carrinho."),console.log(n.message),window.location.reload()}}else{console.log("Carrinho com mais de 1 produto.");i={cpf:localStorage.getItem("dagUserCPF")||null,card:localStorage.getItem("dagUserCard")||null,consultList:s,responseCart:d},i=(window.orionLocalStorage.setItem("dagCurrentCart",JSON.stringify(i),120),window.orionLocalStorage.setItem("dagCurrentProductPBM",JSON.stringify(r),120),{id:r.id,qtt:a,price:t});try{l.addProductInCartPBM(i)}catch(n){console.log("Erro ao adicionar o produto ao carrinho"),console.log(n.message),window.location.reload()}}}}else"A001"==d.responseCode||"QDB6"==d.responseCode||"A001"==d.responseCode||"F480"==d.responseCode||"F475"==d.responseCode||"QDB5"==d.responseCode?(console.log("560"),l.alertError(d)):(console.log("Erro ao colocar no carrinho"),console.log(d))}else alert("Atenção! Você deve selecionar um produto com desconto.")})},addProductInCartPBM:o=>{var e={id:skuJson.skus[0].sku,quantity:o.qtt,seller:"1"};vtexjs.checkout.addToCart([e],null).done(function(e){var t;null!=e.items&&0!=e.items.length&&(t=e.items.find(e=>e.productId==skuJson.productId))&&null!=t&&(t=e.items.findIndex(e=>e.productId==o.id),$.ajax({type:"POST",url:l.routes.changePrice,data:{id:e.orderFormId,index:t,price:o.price}}).done(function(e){l.pbmFront.showLoading.hide(),l.pbmFront.showLoadingComplete.show(),setTimeout(function(){l.pbmFront.showLoadingComplete.hide(),l.pbmFront.showDiscountActivated.show(),setTimeout(function(){window.location.reload()},500)},2e3)}))})},addProductInCartDefault:e=>{e={id:skuJson.skus[0].sku,quantity:e,seller:"1"};vtexjs.checkout.addToCart([e],null).done(function(e){l.pbmFront.showLoading.hide(),l.pbmFront.showLoadingComplete.show(),setTimeout(function(){l.pbmFront.showLoadingComplete.hide(),l.pbmFront.showDiscountActivated.show(),setTimeout(function(){window.location.reload()},500)},2e3)})},applyDefaultsBuybutton:()=>{let t=$(".prod-default-buybuttons.qtt"),o=$(".prod-default-buybuttons.minus"),a=$(".prod-default-buybuttons.plus"),e=$(".prod-default-buybuttons.addcart");setTimeout(function(){if(1==l.pbmSpecData.quantity)return o.addClass("minus-limit"),void a.addClass("more-limit")},1e3),o.on("click",function(e){e.preventDefault(),1==t.val()?$(this).addClass("minus-limit"):(a.removeClass("more-limit"),e=parseInt(t.val()),1==--e&&$(this).addClass("minus-limit"),t.val(e))}),a.on("click",function(e){if(e.preventDefault(),o.removeClass("minus-limit"),1==l.pbmSpecData.quantity)return o.addClass("minus-limit"),void $(this).addClass("more-limit");t.val()==l.pbmSpecData.quantity?$(this).addClass("more-limit"):(e=parseInt(t.val()),(e+=1)==l.pbmSpecData.quantity&&$(this).addClass("more-limit"),t.val(e))}),e.on("click",function(e){e.preventDefault();e={id:skuJson.skus[0].sku,quantity:parseInt(t.val()),seller:l.pbmSpecData.seller};vtexjs.checkout.addToCart([e],null,1).done(function(e){$(document.body).addClass("orion-cart-on")})})},showAcceptTermsModal:e=>{var t=`<iframe src="${e.url}"></iframe>`;$(".dag-terms-modal.block-terms-info").html(`<p>${e.text}</p>`),$(".dag-terms-modal.block-terms").html($(t)),$(document.body).addClass("term-modal-on")},closeAcceptModal:()=>{$("#dag-btn-terms-modal-reload").on("click",function(e){e.preventDefault(),window.location.reload()})},removeDiscountApplied:()=>{$("#pbm-prod-btn-remove-discount").on("click",function(e){e.preventDefault(),l.pbmFront.showDiscountActivated.hide(),l.pbmFront.showLoading.show(),vtexjs.checkout.getOrderForm().then(function(e){let a=[],t=JSON.parse(localStorage.getItem("dagCurrentCart"));return e.items.forEach(o=>{t.consultList.forEach((e,t)=>{o.productId==e.id&&a.push({index:t,quantity:0})})}),vtexjs.checkout.removeItems(a)}).done(function(e){l.clearDiscountAndCart(),setTimeout(function(){l.pbmFront.showLoading.hide(),l.pbmFront.showDefaultDiscount.show(),setTimeout(function(){window.location.reload()},500)},1e3)})})},lockingDefaultBuyButtons:()=>{$(".dag-product.prod-default-buybuttons").hide()},pbmFront:{showDefaultDiscount:{show:function(){$(".pbm-standard-discount").addClass("standard-discount-on")},hide:function(){$(".pbm-standard-discount").removeClass("standard-discount-on")}},showFieldCPF:{show:function(){$(".pbm-document-field").addClass("document-field-on")},hide:function(){$(".pbm-document-field").removeClass("document-field-on")}},showDiscountActivated:{show:function(){$(".pbm-discount-activated").addClass("discount-activated-on")},hide:function(){$(".pbm-discount-activated").removeClass("discount-activated-on")}},showListDiscountsPrices:{show:function(){$(".pbm-list-discounts").addClass("list-discounts-on")},hide:function(){$(".pbm-list-discounts").removeClass("list-discounts-on")}},showLoading:{show:function(){$(".pbm-prod-loader").addClass("pbm-loader-on")},hide:function(){$(".pbm-prod-loader").removeClass("pbm-loader-on")}},showLoadingComplete:{show:function(){$(".pbm-prod-discount-applied").addClass("discount-applied-on")},hide:function(){$(".pbm-prod-discount-applied").removeClass("discount-applied-on")}},showRules:{showFirstRule:function(){$(".pbm-first-rule").addClass("pbm-first-rule-on")},hideFirstRule:function(){$(".pbm-first-rule").removeClass("pbm-first-rule-on")},showSecondRule:function(){$(".pbm-second-rule").addClass("pbm-second-rule-on")},hideSecondRule:function(){$(".pbm-second-rule").removeClass("pbm-second-rule-on")},showThirdRule:function(){$(".pbm-third-rule").addClass("pbm-third-rule-on")},hideThirdRule:function(){$(".pbm-third-rule").removeClass("pbm-third-rule-on")}}},requestProductData:()=>$.ajax({type:"GET",url:l.routes.prodData+skuJson.productId,dataType:"json",contentType:"application/json",headers:{"Content-Type":"application/json",Accept:"application/vnd.vtex.ds.v10+json"}}),requestListDiscounts:e=>$.ajax({type:"POST",url:l.routes.getListDiscounts,data:e}),requestSendProductCart:e=>$.ajax({type:"POST",url:l.routes.getCart,data:e}),interplayersErrors:e=>{"Q542"!=e.responseCode&&"Q563"!=e.responseCode&&"QG43"!=e.responseCode||l.alertError(e)},alertError:e=>{l.pbmFront.showLoading.hide(),swal({title:"Atenção",text:e.message,icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()})},clearDiscountAndCart:()=>{localStorage.removeItem("dagCurrentCart"),localStorage.removeItem("dagCurrentCart_expiration"),localStorage.removeItem("dagCurrentProductPBM"),localStorage.removeItem("dagCurrentProductPBM_expiration")},applyMaskCPF:()=>{},getProductIndexOrderForm:e=>{if(!e)return!1;let t=JSON.parse(localStorage.getItem("dagCurrentCart"))||null;if(!t)return!1;let o=e.findIndex(e=>e.productId==t.consultList.id);return isNaN(o)?"false":0==o?"zero":o.toString()},getCurrentProductPBM:()=>!!orionLocalStorage.getItem("dagCurrentProductPBM")&&JSON.parse(localStorage.getItem("dagCurrentProductPBM")),dateConverterToBrazilTimezone:e=>{let t=new Date;e=(t=e?new Date(t.getTime()+18e5):t).getFullYear().toString()+"-";return(e=(e=(e=(e+=(t.getMonth()+1).toString().padStart(2,"0")+"-")+(t.getDate().toString().padStart(2,"0")+"T"))+(t.getHours().toString().padStart(2,"0")+":"))+(t.getMinutes().toString().padStart(2,"0")+":"))+t.getSeconds().toString().padStart(2,"0")}};$(document).ready(l.init);$(window).load(function(){l.windowOnload()}),$(document).ajaxStop(l.ajaxStop)}catch(e){console.log("Erro na instância do [PBMproduct]: ",e)}}();