(function () {
    
    try {
        // 13310407012
        // 60557752043
        // 36820782829
        // 28150849025
        // CPF Myra: 08199188650
        // 96658001901
        // CPF AD: 59766682089
        // CUPOM: 9960530000066
        const middleware = 'https://drogariaglobo-middleware.herokuapp.com';
        let PBMproduct = {
            init: () => {
                PBMproduct.applyMaskCPF();
                PBMproduct.verifyStatusDiscount(); 
                PBMproduct.getProductData();
                PBMproduct.pbmAllEvents();
                PBMproduct.closeAcceptModal();
                PBMproduct.applySelectedDiscount();
                PBMproduct.removeDiscountApplied();
            },
            windowOnload: () => {},
            ajaxStop: () => {},
            pbmSpecData: null,
            pbmTypeField: null,
            routes: {
                prodData: "/api/catalog_system/pub/products/search/?fq=productId:",
                getListDiscounts: `${middleware}/middleware/v1/prices-discounts`,
                getCart: `${middleware}/middleware/v1/cart`,
                changePrice: `${middleware}/middleware/v1/change-price-vtex`
            },
            verifyStatusDiscount: () => {
                if (orionLocalStorage.getItem("dagCurrentCart")) {
                    let currentCart = JSON.parse(localStorage.getItem("dagCurrentCart"));
                    let findProduct = currentCart.consultList.find(item => {
                        return item.id == skuJson.productId;
                    });
                    if (findProduct) {
                        $(".product-right__buy-button").hide();
                        $(".pbm-discount-activated").addClass("discount-activated-on");

                        PBMproduct.lockingDefaultBuyButtons();
                    } else {
                        $(".pbm-standard-discount").addClass("standard-discount-on");
                    }
                } else {
                    $(".pbm-standard-discount").addClass("standard-discount-on");
                }
            },
            // Dados do produto
            getProductData: async () => {
                let respProdData = await PBMproduct.requestProductData();
                PBMproduct.data = respProdData[0];
                PBMproduct.checkingIfHasPBM(PBMproduct.data);
            },
            // Verificando se faz parte do PBM
            checkingIfHasPBM: (prodData) => {
                if (prodData.productPbmOn && prodData.productPbmOn && prodData.productPbmOn == 'S') {
                    if (!prodData.formattedPrice || !prodData.standardPrice) {
                        $(".dag-product.pbm").hide();
                        return;
                    }

                    // Salvando todas especificaoes relacionadas ao PBM
                    PBMproduct.pbmSpecData = {
                        requestHolderId: prodData.requestHolderId[0],
                        productPbmOn: prodData.productPbmOn[0],
                        requestCoupon: prodData.requestCoupon[0],
                        eanCombos: prodData.eanCombos[0],
                        industryName: prodData.industryName[0],
                        todayTableId: prodData.todayTableId[0],
                        formattedPrice: prodData.formattedPrice[0],
                        standardPrice: prodData.standardPrice[0],
                        listPrice: prodData.items[0].sellers[0].commertialOffer.ListPrice,
                        netPrice: prodData.items[0].sellers[0].commertialOffer.PriceWithoutDiscount,
                        discountType: prodData.discountType[0]
                    }
                    // PBMproduct.pbmSpecData.todayTableId
                    // PBMproduct.pbmSpecData.discountType
                    localStorage.setItem("dagDataProduct", JSON.stringify(PBMproduct.pbmSpecData));

                    if (
                        PBMproduct.pbmSpecData.requestHolderId == "M" && 
                        PBMproduct.pbmSpecData.requestCoupon == "O"
                    ) {
                        PBMproduct.pbmTypeField = 1;
                        if (localStorage.getItem("dagUserCPF")) {
                            let cpf = localStorage.getItem("dagUserCPF");
                            $("#pbm-first-rule-cpf").val(cpf);
                        }
                    } else if (
                        PBMproduct.pbmSpecData.requestHolderId == "M" && 
                        PBMproduct.pbmSpecData.requestCoupon == "M"
                    ) {
                        PBMproduct.pbmTypeField = 2;
                        if (localStorage.getItem("dagUserCPF")) {
                            let cpf = localStorage.getItem("dagUserCPF");
                            $("#pbm-second-rule-cpf").val(cpf);
                        }
                        if (localStorage.getItem("dagUserCard")) {
                            let card = localStorage.getItem("dagUserCard");
                            $(".pbm-card-field").val(card);
                        }
                    } else if (
                        PBMproduct.pbmSpecData.requestHolderId == "O" && 
                        PBMproduct.pbmSpecData.requestCoupon == "M"
                    ) {
                        PBMproduct.pbmTypeField = 3;
                        if (localStorage.getItem("dagUserCard")) {
                            let card = localStorage.getItem("dagUserCard");
                            $(".pbm-card-field").val(card);
                        }
                    }

                    $(".pbm-prod-price").text(PBMproduct.pbmSpecData.standardPrice);
                    $(".pbm-prod-discount-activated-text").text(PBMproduct.pbmSpecData.industryName);
                }
            },
            pbmAllEvents: () => {
                console.clear();

                // Botão Desconto Padrão
                let btnDefaultDiscount = $(".pbm-standard-discount");
                btnDefaultDiscount.on("click", function (e) {
                    e.preventDefault();

                    if (PBMproduct.pbmTypeField == 1) {
                        console.log("TIPO 1 - M e O");
                        PBMproduct.pbmFront.showDefaultDiscount.hide()
                        $(".pbm-first-rule").addClass("pbm-first-rule-on");
                    } 
                    else if (PBMproduct.pbmTypeField == 2) {
                        console.log("TIPO 2 - M e M");
                        PBMproduct.pbmFront.showDefaultDiscount.hide()
                        $(".pbm-second-rule").addClass("pbm-second-rule-on");
                    } 
                    else if (PBMproduct.pbmTypeField == 3) {
                        console.log("TIPO 1 - O e M");
                        PBMproduct.pbmFront.showDefaultDiscount.hide()
                        $(".pbm-third-rule").addClass("pbm-third-rule-on");
                    }

                });

                // Botão remover desconto
                let btnRemoveDiscount = $(".pbm-list-discounts-finded--remove");
                btnRemoveDiscount.on("click", function (e) {
                    e.preventDefault();

                    $(".pbm-cpf-field").val('');
                    if (PBMproduct.pbmTypeField == 1) {
                        PBMproduct.pbmFront.showRules.hideFirstRule();
                    } 
                    else if (PBMproduct.pbmTypeField == 2) {
                        PBMproduct.pbmFront.showRules.hideSecondRule();
                    } 
                    else if (PBMproduct.pbmTypeField == 3) {
                        PBMproduct.pbmFront.showRules.hideThirdRule();
                    }

                    PBMproduct.pbmFront.showListDiscountsPrices.hide();
                    PBMproduct.pbmFront.showDefaultDiscount.show();
                });

                let pbmAddButton = $(".pbm-add-button");
                pbmAddButton.on("click", function (e) {
                    e.preventDefault();

                    let CPF = null;
                    let CARD = null;
                    if (PBMproduct.pbmTypeField == 1) {
                        CPF = $("#pbm-first-rule-cpf").val();

                        if (CPF.length < 11) { // 14
                            alert("CPF Incompleto. [1]");
                            return;
                        }
                        localStorage.removeItem("dagUserCard");
                        PBMproduct.pbmFront.showRules.hideFirstRule();
                    } 
                    else if (PBMproduct.pbmTypeField == 2) {
                        CPF = $("#pbm-second-rule-cpf").val();
                        CARD = $("#pbm-second-rule-card").val();

                        if (CPF.length < 11) { // 14
                            alert("CPF Incompleto. [2]");
                            return;
                        }
                        if (CARD.length == 0) {
                            alert("O Nº do cartão é obrigatório. [1]");
                            return;
                        }
                        window.orionLocalStorage.setItem("dagUserCard", CARD, 120);
                        PBMproduct.pbmFront.showRules.hideSecondRule();
                    } 
                    else if (PBMproduct.pbmTypeField == 3) {
                        CARD = $("#pbm-third-rule-card").val();
                        if (CARD.length == 0) {
                            alert("O Nº do cartão é obrigatório. [2]");
                            return;
                        }
                        localStorage.removeItem("dagUserCPF");
                        PBMproduct.pbmFront.showRules.hideThirdRule();
                    }

                    PBMproduct.pbmFront.showLoading.show();

                    // CPF = CPF.replace(/[^\w\s]/g, "");
                    if (CPF.match(/[^\w\s]/g)) {
                        CPF = CPF.replace(/[^\w\s]/g, "");
                    }
                    window.orionLocalStorage.setItem("dagUserCPF", CPF, 120);
                    if (localStorage.getItem("dagUserForm")) {
                        let formFields = JSON.parse(localStorage.getItem("dagUserForm"));
                        if (formFields.holderId != CPF) {
                            formFields.holderId = CPF;
                        }
                        localStorage.setItem("dagUserForm", JSON.stringify(formFields));
                    }

                    let lp = PBMproduct.pbmSpecData.listPrice;
                    let np = PBMproduct.pbmSpecData.netPrice;
                    let prodInfo = {
                        id: PBMproduct.data.productId,
                        packId: 0,
                        EAN: PBMproduct.data.items[0].ean,
                        requestedQuantity: 1,
                        pricesOriginal: {
                            listPrice: lp,
                            netPrice: np,
                        },
                        pricesFormatted: {
                            listPrice: lp.toString().replace(".", ""),
                            netPrice: np.toString().replace(".", ""),
                        },
                        discountType: PBMproduct.pbmSpecData.discountType,
                        tableId: PBMproduct.pbmSpecData.todayTableId
                    }

                    window.orionLocalStorage.setItem("dagCurrentProductPBM", JSON.stringify(prodInfo), 120);
                    PBMproduct.consultDiscountIntegration(CPF, CARD, prodInfo);

                });

            },
            consultDiscountIntegration: async (CPF, CARD, prodInfo) => {
                // Body da requests
                let bodyRequest = {
                    cpf: CPF,
                    card: CARD,
                    product: prodInfo
                }

                // Response
                let respConsult = await PBMproduct.requestListDiscounts(bodyRequest);

                // [1] - Aceitar termo de adesão
                if (respConsult.responseCode == "H119" || respConsult.responseCode == "H120") {
                    PBMproduct.pbmFront.showLoading.hide();
                    let info = {
                        url: respConsult.urlTerms,
                        text: respConsult.message
                    }
                    PBMproduct.showAcceptTermsModal(info);
                }
                // [2] - Cadastro do consumidor
                else if (
                    respConsult.responseCode == "Q291" || 
                    respConsult.responseCode == "Q292" || 
                    respConsult.responseCode == "Q293" || 
                    respConsult.responseCode == "Q294" || 
                    respConsult.responseCode == "Q295"
                ) {
                    PBMproduct.pbmFront.showLoading.hide();
                    // Salvando o central number
                    localStorage.setItem("dagCentralNumber", respConsult.centralNumber);
                    swal({
                        title: "Termos aceitos!",
                        text: respConsult.message,
                        icon: "success",
                        closeOnClickOutside: false
                    }).then(() => {
                        window.location.pathname = '/cadastro-programa';
                    });
                }
                else if (respConsult.responseCode == "H127") {
                    PBMproduct.pbmFront.showLoading.hide();
                    swal({
                        title: "Atenção",
                        text: "Este canal não permite adesão. Faça a adesão através do 0800 707 1080 ou www.valemaissaude.com.br.",
                        icon: "warning",
                        closeOnClickOutside: false
                    }).then(() => {
                        window.location.reload();
                    });
                }
                else if (respConsult.responseCode == "N000") {
                    PBMproduct.renderListDiscountsPrices(respConsult.listPrices);

                    PBMproduct.pbmFront.showLoading.hide();
                    PBMproduct.pbmFront.showListDiscountsPrices.show();
                } 
                else if (respConsult.responseCode == "W003") {
                    PBMproduct.renderListDiscountsPrices(respConsult.listPrices);

                    PBMproduct.pbmFront.showLoading.hide();
                    PBMproduct.pbmFront.showListDiscountsPrices.show();
                }
                else if (respConsult.responseCode == "F803") {
                    PBMproduct.pbmFront.showLoading.hide();
                    swal({
                        title: "Atenção",
                        text: respConsult.message,
                        icon: "warning",
                        closeOnClickOutside: false
                    }).then(() => {
                        window.location.reload();
                    });
                } 
                else if (respConsult.responseCode == "Q027") {
                    PBMproduct.pbmFront.showLoading.hide();
                    swal({
                        title: "Atenção",
                        text: respConsult.message,
                        icon: "warning",
                        closeOnClickOutside: false
                    }).then(() => {
                        window.location.reload();
                    });
                }
                // Tratavias de erros em Geral
                else if (respConsult && respConsult.interplayersError) {
                    console.log("ALERTA INTERPLAYERS!");
                    PBMproduct.interplayersErrors(respConsult);
                }

            },
            // Montando a lista de desconto
            renderListDiscountsPrices: (listPrices) => {
                let wrapper = $(".pbm-list-discounts-prices-wrapper");
                let wrapperInfo = $(".pbm-list-discounts-finded--value");
                let wrapperCurrentValue = $(".pbm-list-discounts-current-price--value");
                let listElements = '';
                listPrices.forEach(function (item) {
                    let block = `
                        <div class="pbm-list-discounts-prices" data-price="${item.price}" data-quantity="${item.quantity}">
                            <span class="pbm-list-discounts-prices--check"></span>
                            <span class="pbm-list-discounts-prices--unity">${item.quantity} UN.</span>
                            <span class="pbm-list-discounts-prices--value">${item.priceFormatted}</span>
                        </div>`;
                    listElements += block;
                });
                if (listPrices.length == 1) {
                    wrapperInfo.text(`${listPrices.length} desconto`);
                } else {
                    wrapperInfo.text(`${listPrices.length} descontos`);
                }
                let vtexValue = $(".skuBestPrice").text();
                wrapperCurrentValue.text(vtexValue);
                wrapper.html(listElements);
                PBMproduct.applySelectFieldsDiscounts();
            },
            applySelectFieldsDiscounts: () => {
                let btnBlockPrices = $(".pbm-list-discounts-prices-wrapper .pbm-list-discounts-prices");
                btnBlockPrices.on("click", function (e) {
                    e.preventDefault();

                    // 133.104.070-12
                    let $t = $(this);
                    $t.siblings().removeClass('price-discount-selected');
                    $t.addClass("price-discount-selected");
                });
            },
            // Aplica o desconto e muda o preço
            applySelectedDiscount: () => {
                // 133.104.070-12
                let btnApplySelectedDiscount = $("#pbm-btn-apply-discount");
                btnApplySelectedDiscount.on("click", async function (e) {
                    e.preventDefault();

                    if (!$(".pbm-list-discounts-prices-wrapper .pbm-list-discounts-prices").is(".price-discount-selected")) {
                        alert("Atenção! Você deve selecionar um produto com desconto.");
                        return;
                    }

                    PBMproduct.pbmFront.showListDiscountsPrices.hide();
                    PBMproduct.pbmFront.showLoading.show();

                    let priceSelected = $(".pbm-list-discounts-prices-wrapper .pbm-list-discounts-prices.price-discount-selected");
                    let dataPrice = priceSelected.attr("data-price");
                    let dataQuantity = priceSelected.attr("data-quantity");
                    let currentProduct = localStorage.getItem("dagCurrentProductPBM");
                    currentProduct = JSON.parse(currentProduct);

                    // Ajustando os valores
                    currentProduct.pricesOriginal.listPrice = dataPrice;
                    currentProduct.pricesOriginal.netPrice = dataPrice;
                    currentProduct.pricesFormatted.listPrice = dataPrice.toString().replace(".", "");
                    currentProduct.pricesFormatted.netPrice = dataPrice.toString().replace(".", "");

                    // Setando a quantidade
                    currentProduct.requestedQuantity = dataQuantity;

                    let listCartProduts = [];
                    if (!orionLocalStorage.getItem("dagCurrentCart")) {
                        listCartProduts.push(currentProduct);
                    } else {
                        let interCart = JSON.parse(localStorage.getItem("dagCurrentCart"));
                        listCartProduts = interCart.consultList;
                        listCartProduts.push(currentProduct);
                    }

                    // Body da request
                    let bodyRequest = {
                        cpf: localStorage.getItem("dagUserCPF"),
                        consultList: listCartProduts,
                        tableId: PBMproduct.pbmSpecData.todayTableId
                    }
                    
                    // Request
                    const respCart = await PBMproduct.requestSendProductCart(bodyRequest);

                    // Sucesso ao colocar o produto no carrinho
                    if (respCart.returnCode == "N000") {
                        if (listCartProduts.length == 1) {
                            let dataCart = { 
                                cpf: localStorage.getItem("dagUserCPF"),
                                consultList: listCartProduts,
                                responseCart: respCart
                            }
                            window.orionLocalStorage.setItem("dagCurrentCart", JSON.stringify(dataCart), 120);
                        } else {
                            let currentCart = JSON.parse(localStorage.getItem("dagCurrentCart")) || null;
                            if (currentCart == null) {
                                alert("Atenção! Carrinho vazio.");
                                return;
                            }

                            currentCart.consultList = listCartProduts;
                            currentCart.responseCart = respCart;
                            window.orionLocalStorage.setItem("dagCurrentCart", JSON.stringify(currentCart), 120);
                        }

                        window.orionLocalStorage.setItem("dagCurrentProductPBM", JSON.stringify(currentProduct), 120);

                        let dataParam = {
                            id: currentProduct.id,
                            qtt: dataQuantity,
                            price: currentProduct.pricesFormatted.netPrice
                        }

                        PBMproduct.addProductInCart(dataParam);

                    }
                    else if (respCart.responseCode == "A001") {
                        PBMproduct.alertError(respCart);
                    }
                    else if (respCart.responseCode == "QDB6") {
                        PBMproduct.alertError(respCart);
                    }
                    else {
                        console.log("Erro ao colocar no carrinho");
                        console.log(respCart);
                    }
                });
            },
            addProductInCart: (dataParam) => {
                let itemToCart = {
                    id: skuJson.skus[0].sku,
                    quantity: dataParam.qtt,
                    seller: '1'
                };

                vtexjs.checkout.addToCart([itemToCart], null).done(function (newOrderForm) {
                    // Verificando se o minicart está vazio
                    if (newOrderForm.items == null || newOrderForm.items.length == 0) {
                        return;
                    }

                    // Iterando os produtos no carrinho
                    let findProduct = newOrderForm.items.find(item => {
                        return item.productId == skuJson.productId;
                    });

                    // Verificando se tem produto com desconto do PBM
                    if (!findProduct || findProduct == undefined) {
                        return;
                    }
                    
                    // Localizando o index (vai na request de change price)
                    let findIndex = newOrderForm.items.findIndex(item => {
                        return item.productId == dataParam.id;
                    });

                    // Mudando o preço
                    $.ajax({
                        type: "POST",
                        url: PBMproduct.routes.changePrice,
                        data: {
                            id: newOrderForm.orderFormId,
                            index: findIndex,
                            price: dataParam.price
                        }
                    }).done(function (data) {
                        PBMproduct.pbmFront.showLoading.hide();
                        PBMproduct.pbmFront.showLoadingComplete.show();
                        setTimeout(function () {
                            PBMproduct.pbmFront.showLoadingComplete.hide();
                            PBMproduct.pbmFront.showDiscountActivated.show();

                            setTimeout(function() {
                                window.location.reload();
                            }, 500);
                        }, 2000);
                    });
                });
            },
            // Modal Cadastro e Termos
            showAcceptTermsModal: (info) => {
                let iframe = `<iframe src="${info.url}"></iframe>`;
                $(".dag-terms-modal.block-terms-info").html(`<p>${info.text}</p>`);
                $(".dag-terms-modal.block-terms").html($(iframe));
                $(document.body).addClass("term-modal-on");
            },
            closeAcceptModal: () => {
                let btnCloseModal = $("#dag-btn-terms-modal-reload");
                btnCloseModal.on("click", function (e) {
                    e.preventDefault();

                    // $(".dag-terms-modal.block-terms").empty();
                    // $(document.body).removeClass("term-modal-on");
                    window.location.reload();
                });
            },
            // Remove Desconto e Produto
            removeDiscountApplied: () => {
                // Botão remover desconto e produto ativo atual
                let btnRemoveActivated = $("#pbm-prod-btn-remove-discount");
                btnRemoveActivated.on("click", function (e) {
                    e.preventDefault();

                    PBMproduct.pbmFront.showDiscountActivated.hide();
                    PBMproduct.pbmFront.showLoading.show();
                    
                    vtexjs.checkout.getOrderForm().then(function(orderForm) {
                        let itemsToRemove = [];
                        let dataCart = JSON.parse(localStorage.getItem("dagCurrentCart"));
                        orderForm.items.forEach(item => {
                            dataCart.consultList.forEach((subItem, index) => {
                                if (item.productId == subItem.id) {
                                    itemsToRemove.push({
                                        index: index,
                                        quantity: 0
                                    });
                                }
                            });
                        });

                        return vtexjs.checkout.removeItems(itemsToRemove);
                    }).done(function(newOrderForm) {
                        // Limpando o produto do carrinho do PBM e da navegação
                        PBMproduct.clearDiscountAndCart();
                        setTimeout(function () {
                            PBMproduct.pbmFront.showLoading.hide();
                            PBMproduct.pbmFront.showDefaultDiscount.show();
                            setTimeout(function () {
                                window.location.reload();
                            }, 500);
                        }, 1000);
                    });
                });
            },
            lockingDefaultBuyButtons: () => {},
            // Front functions (Show|Hide PBM elements)
            pbmFront: {
                showDefaultDiscount: {
                    show: function () { // pbmFront.showDefaultDiscount.show();
                        $(".pbm-standard-discount").addClass("standard-discount-on");
                    },
                    hide: function () { 
                        $(".pbm-standard-discount").removeClass("standard-discount-on");
                    }
                },
                showFieldCPF: {
                    show: function () { 
                        $(".pbm-document-field").addClass("document-field-on");
                    },
                    hide: function () { 
                        $(".pbm-document-field").removeClass("document-field-on");
                    }
                },
                showDiscountActivated: {
                    show: function () { 
                        $(".pbm-discount-activated").addClass("discount-activated-on");
                    },
                    hide: function () { 
                        $(".pbm-discount-activated").removeClass("discount-activated-on");
                    }
                },
                showListDiscountsPrices: {
                    show: function () { 
                        $(".pbm-list-discounts").addClass("list-discounts-on");
                    },
                    hide: function () { 
                        $(".pbm-list-discounts").removeClass("list-discounts-on");
                    }
                },
                showLoading: {
                    show: function () {
                        $(".pbm-prod-loader").addClass("pbm-loader-on");
                    },
                    hide: function () {
                        $(".pbm-prod-loader").removeClass("pbm-loader-on");
                    }
                },
                showLoadingComplete: {
                    show: function () { 
                        $(".pbm-prod-discount-applied").addClass("discount-applied-on");
                    },
                    hide: function () { 
                        $(".pbm-prod-discount-applied").removeClass("discount-applied-on");
                    }
                },
                showRules: {
                    showFirstRule: function () { // PBMproduct.pbmFront.showRules.showFirstRule();
                        $(".pbm-first-rule").addClass("pbm-first-rule-on");
                    },
                    hideFirstRule: function () { // PBMproduct.pbmFront.showRules.hideFirstRule();
                        $(".pbm-first-rule").removeClass("pbm-first-rule-on");
                    },
                    showSecondRule: function () { // PBMproduct.pbmFront.showRules.showSecondRule();
                        $(".pbm-second-rule").addClass("pbm-second-rule-on");
                    },
                    hideSecondRule: function () { // PBMproduct.pbmFront.showRules.hideSecondRule();
                        $(".pbm-second-rule").removeClass("pbm-second-rule-on");
                    },
                    showThirdRule: function () { // PBMproduct.pbmFront.showRules.showThirdRule();
                        $(".pbm-third-rule").addClass("pbm-third-rule-on");
                    },
                    hideThirdRule: function () { // PBMproduct.pbmFront.showRules.hideThirdRule();
                        $(".pbm-third-rule").removeClass("pbm-third-rule-on");
                    }
                }
            },
            // Requests
            requestProductData: () => {
                return $.ajax({
                    type: "GET",
                    url: PBMproduct.routes.prodData + skuJson.productId,
                    dataType: "json",
                    contentType: "application/json",
                    headers: {
                        "Content-Type": "application/json",
                        "Accept": "application/vnd.vtex.ds.v10+json"
                    }
                });
            },
            requestListDiscounts: (bodyRequest) => {
                return $.ajax({
                    type: "POST",
                    url: PBMproduct.routes.getListDiscounts,
                    data: bodyRequest
                });
            },
            requestSendProductCart: (bodyRequest) => {
                return $.ajax({
                    type: "POST",
                    url: PBMproduct.routes.getCart,
                    data: bodyRequest
                });
            },
            // Trativas de Erros Interplayers
            interplayersErrors: (respConsult) => {
                if (respConsult.responseCode == "Q542") {
                    PBMproduct.alertError(respConsult);
                    // PBMproduct.pbmFront.showLoading.hide();
                    // swal({
                    //     title: "Atenção",
                    //     text: respConsult.message,
                    //     icon: "warning",
                    //     closeOnClickOutside: false
                    // }).then(() => {
                    //     window.location.reload();
                    // });
                } else if (respConsult.responseCode == "Q563") {
                    PBMproduct.alertError(respConsult);
                    // PBMproduct.pbmFront.showLoading.hide();
                    // swal({
                    //     title: "Atenção",
                    //     text: respConsult.message,
                    //     icon: "warning",
                    //     closeOnClickOutside: false
                    // }).then(() => {
                    //     window.location.reload();
                    // });
                } else if (respConsult.responseCode == "QG43") {
                    PBMproduct.alertError(respConsult);
                    // PBMproduct.pbmFront.showLoading.hide();
                    // swal({
                    //     title: "Atenção",
                    //     text: respConsult.message,
                    //     icon: "warning",
                    //     closeOnClickOutside: false
                    // }).then(() => {
                    //     window.location.reload();
                    // });
                }
            },
            alertError: (respConsult) => {
                PBMproduct.pbmFront.showLoading.hide();
                swal({
                    title: "Atenção",
                    text: respConsult.message,
                    icon: "warning",
                    closeOnClickOutside: false
                }).then(() => {
                    window.location.reload();
                });
            },
            // Limpa o carrinho, limpa o desconto atual
            clearDiscountAndCart: () => {
                localStorage.removeItem("dagCurrentCart");
                localStorage.removeItem("dagCurrentCart_expiration");

                localStorage.removeItem("dagCurrentProductPBM");
                localStorage.removeItem("dagCurrentProductPBM_expiration");
            },
            // Mask CPF
            applyMaskCPF: () => {
                // $("#pbm-first-rule-cpf").mask('000.000.000-00', { reverse: true });
                // $("#pbm-second-rule-cpf").mask('000.000.000-00', { reverse: true });
            },
            // Return Index Product In Order Form
            getProductIndexOrderForm: (items) => {
                if (!items) {
                    return false;
                }

                // let prodPBM = PBMproduct.getCurrentProductPBM();
                // if (!prodPBM) {
                //     return false;
                // }
                let cartList = JSON.parse(localStorage.getItem("dagCurrentCart")) || null;
                if (!cartList) {
                    return false;
                }

                // Localizando o index (vai na request de change price)
                let findIndex = items.findIndex(item => {
                    return item.productId == cartList.consultList.id;
                }); 

                if (!isNaN(findIndex)) {
                    if (findIndex == 0) {
                        return "zero"
                    } else {
                        return findIndex.toString();
                    }
                } else {
                    return "false";
                }
            },
            getCurrentProductPBM: () => {
                if (orionLocalStorage.getItem("dagCurrentProductPBM")) {
                    return JSON.parse(localStorage.getItem("dagCurrentProductPBM"));
                } else {
                    return false;
                }
            },
            // Utils
            dateConverterToBrazilTimezone: (isToCallToken) => {
                // Conversor: Adiciona + 30 minutos da data atual para a expiração do token
                let date = new Date();
                if (isToCallToken) {
                    date = new Date(date.getTime() + 30 * 60000);
                }
                var iso = date.getFullYear().toString() + "-";
                iso += (date.getMonth() + 1).toString().padStart(2, '0') + "-";
                iso += date.getDate().toString().padStart(2, '0') + "T";
                iso += date.getHours().toString().padStart(2, '0') + ":";
                iso += date.getMinutes().toString().padStart(2, '0') + ":";
                iso += date.getSeconds().toString().padStart(2, '0');

                return iso;
            }
        };

        // Instanciando a funcao
        $(document).ready(PBMproduct.init);
        let windowLoad = function () {
            PBMproduct.windowOnload();
        };
        $(window).load(windowLoad);
        $(document).ajaxStop(PBMproduct.ajaxStop);

    } catch (e) {
        console.log("Erro na instância do [PBMproduct]: ", e);
    }

})();
