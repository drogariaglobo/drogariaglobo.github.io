!function(){try{let a={init:()=>{a.verifyToken(),a.getProductData(),a.pbmAllEvents(),a.applyMaskCPF()},windowOnload:()=>{},ajaxStop:()=>{},data:null,pbmSpecData:null,routes:{prodData:"/api/catalog_system/pub/products/search/?fq=productId:",getToken:"https://api-mng.interplayers.com.br/gip-scs-svc/token",getConsultDiscount:"https://drogariaglobo-middleware.herokuapp.com/dagmiddleware/consult-discount"},verifyToken:async()=>{if($.cookie("dagInterplayersToken")){var t=$.cookie("dagInterplayersToken_expiration"),t=new Date(t);if(new Date<t)return void console.log("Token ativo.");$.removeCookie("dagInterplayersToken"),$.removeCookie("dagInterplayersToken_expiration")}t=await a.requestGenerateToken();if(t&&t.access_token){console.log("Novo token");let e=a.dateConverterToBrazilTimezone(!0);$.cookie("dagInterplayersToken",t.access_token,{expires:1}),$.cookie("dagInterplayersToken_expiration",e.toString(),{expires:1})}},getProductData:async()=>{var e=await a.requestProductData();a.data=e[0],a.checkingIfHasPBM(a.data)},checkingIfHasPBM:e=>{e.productPbmOn&&e.productPbmOn&&"S"==e.productPbmOn&&(a.pbmSpecData={requestHolderId:e.requestHolderId[0],productPbmOn:e.productPbmOn[0],requestCoupon:e.requestCoupon[0],eanCombos:e.eanCombos[0],industryName:e.industryName[0],todayTableId:e.todayTableId[0],formattedPrice:e.formattedPrice[0],standardPrice:e.standardPrice[0]},console.log(a.pbmSpecData),a.showStandartDiscount(e.standardPrice[0]))},pbmAllEvents:()=>{$(".pbm-standard-discount").on("click",function(e){e.preventDefault(),console.log("[standartDiscount]"),$(this).removeClass("standard-discount-on"),$(".pbm-document-field").addClass("document-field-on")}),$("#pbm-prod-btn-cpf-add").on("click",function(e){e.preventDefault(),console.log("[cpf]"),$(this);let t=$("#pbm-prod-input-cpf").val();var o;skuJson.productId,t.length<14?alert("CPF Incompleto."):(t=t.replace(/[^\w\s]/g,""),e=a.data.items[0].sellers[0].commertialOffer.ListPrice.toString().replace(".",""),o=a.data.items[0].sellers[0].commertialOffer.Price.toString().replace(".",""),e={id:a.data.productId,packId:0,EAN:a.data.items[0].ean,requestedQuantity:1,listPrice:e,netPrice:o,discountType:"L"},o={id:a.data.productId,EAN:a.data.items[0].ean,requestedQuantity:1},console.log("Dados!"),console.log(e),console.log(o),a.integrationStepsConsult(t,e))})},integrationStepsConsult:async(e,t)=>{e={token:$.cookie("dagInterplayersToken"),control:{clientId:"36C0ED06-5F33-448C-96E4-A5AE1AAD3142",username:"A5FB2147-D606-6DEA-8314-17D5644B19D3",tableId:"37303932-3232-3130-3330-393933333632",localNumber:8888,centralNumber:localStorage.getItem("dagCentralNumber")||0,localHour:a.dateConverterToBrazilTimezone(null),industryId:"999",stationId:"",companyCode:"99999994001998",attendanceHash:"",terminalId:"ECOMMERCE"},consumer:{holderId:e,cardId:""},product:[t]},t=await a.requestConsultDiscount(e);console.log(t)},showStandartDiscount:e=>{$(".pbm-prod-price").text(e)},showAcceptTermsModal:e=>{var t=`<iframe src="${e.url}"></iframe>`;$(".dag-terms-modal.block-terms-info").html(`<p>${e.text}</p>`),$(".dag-terms-modal.block-terms").html($(t)),$(document.body).addClass("term-modal-on")},pbmFront:{showDefaultDiscount:function(){},showFieldCPF:function(){},showListDiscountsPrices:function(){},showCurrentDiscountActived:function(){},showLoading:function(){},showDiscountApplied:function(){}},requestGenerateToken:()=>$.ajax({type:"POST",url:a.routes.getToken,data:{Client_Id:"36C0ED06-5F33-448C-96E4-A5AE1AAD3142",Client_Secret:"VP2TQfEL#mF3!rsW",Grant_Type:"client_credentials"}}),requestProductData:()=>$.ajax({type:"GET",url:a.routes.prodData+skuJson.productId,dataType:"json",contentType:"application/json",headers:{"Content-Type":"application/json",Accept:"application/vnd.vtex.ds.v10+json"}}),requestConsultDiscount:e=>$.ajax({type:"POST",url:a.routes.getConsultDiscount,data:e}),applyMaskCPF:()=>{$("#pbm-prod-input-cpf").mask("000.000.000-00",{reverse:!0})},dateConverterToBrazilTimezone:e=>{let t=new Date;e=(t=e?new Date(t.getTime()+18e5):t).getFullYear().toString()+"-";return(e=(e=(e=(e+=(t.getMonth()+1).toString().padStart(2,"0")+"-")+(t.getDate().toString().padStart(2,"0")+"T"))+(t.getHours().toString().padStart(2,"0")+":"))+(t.getMinutes().toString().padStart(2,"0")+":"))+t.getSeconds().toString().padStart(2,"0")}};$(document).ready(a.init);$(window).load(function(){a.windowOnload()}),$(document).ajaxStop(a.ajaxStop)}catch(e){console.log("Erro na inst√¢ncia do [PBMproduct]: ",e)}}();