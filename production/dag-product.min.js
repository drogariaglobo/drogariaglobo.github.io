!function(){try{var e="https://drogariaglobo-middleware.herokuapp.com";let i={init:()=>{i.verifyToken(),i.verifyStatusDiscount(),i.getProductData(),i.pbmAllEvents(),i.applyMaskCPF(),i.closeAcceptModal(),i.applySelectedDiscount(),i.removeDiscountApplied()},windowOnload:()=>{},ajaxStop:()=>{},data:null,pbmSpecData:null,routes:{prodData:"/api/catalog_system/pub/products/search/?fq=productId:",getToken:"https://api-mng.interplayers.com.br/gip-scs-svc/token",getListDiscounts:e+"/middleware/v1/prices-discounts",getCart:e+"/middleware/v1/cart",changePrice:e+"/middleware/v1/change-price-vtex"},verifyToken:async()=>{if($.cookie("dagInterplayersToken")){var t=$.cookie("dagInterplayersToken_expiration"),t=new Date(t);if(new Date<t)return void console.log("Token ativo.");$.removeCookie("dagInterplayersToken"),$.removeCookie("dagInterplayersToken_expiration")}t=await i.requestGenerateToken();if(t&&t.access_token){console.log("Novo token");let e=i.dateConverterToBrazilTimezone(!0);$.cookie("dagInterplayersToken",t.access_token,{expires:1}),$.cookie("dagInterplayersToken_expiration",e.toString(),{expires:1})}},verifyStatusDiscount:()=>{orionLocalStorage.getItem("dagCurrentCart")?JSON.parse(localStorage.getItem("dagCurrentCart")).consultList.find(e=>e.id==skuJson.productId)?(console.log("Encontrado!"),$(".pbm-discount-activated").addClass("discount-activated-on")):(console.log("Não encontrado!"),$(".pbm-standard-discount").addClass("standard-discount-on")):$(".pbm-standard-discount").addClass("standard-discount-on")},getProductData:async()=>{var e=await i.requestProductData();i.data=e[0],i.checkingIfHasPBM(i.data)},checkingIfHasPBM:e=>{e.productPbmOn&&e.productPbmOn&&"S"==e.productPbmOn&&(e.formattedPrice&&e.standardPrice?(i.pbmSpecData={requestHolderId:e.requestHolderId[0],productPbmOn:e.productPbmOn[0],requestCoupon:e.requestCoupon[0],eanCombos:e.eanCombos[0],industryName:e.industryName[0],todayTableId:e.todayTableId[0],formattedPrice:e.formattedPrice[0],standardPrice:e.standardPrice[0]},$(".pbm-prod-price").text(i.pbmSpecData.standardPrice),$(".pbm-prod-discount-activated-text").text(i.pbmSpecData.industryName)):$(".dag-product.pbm").hide())},pbmAllEvents:()=>{let a=$(".pbm-document-field");$(".pbm-standard-discount").on("click",function(e){e.preventDefault(),i.pbmFront.showDefaultDiscount.hide(),i.pbmFront.showFieldCPF.show()}),$(".pbm-list-discounts-finded--remove").on("click",function(e){e.preventDefault(),i.pbmFront.showListDiscountsPrices.hide(),i.pbmFront.showDefaultDiscount.show()}),$("#pbm-prod-btn-cpf-add").on("click",function(e){e.preventDefault();let n=$("#pbm-prod-input-cpf").val();if(n.length<14)alert("CPF Incompleto.");else{a.removeClass("document-field-on"),i.pbmFront.showLoading.show(),n=n.replace(/[^\w\s]/g,""),window.orionLocalStorage.setItem("dagUserCPF",n,120);let e=i.data.items[0].sellers[0].commertialOffer.ListPrice,t=i.data.items[0].sellers[0].commertialOffer.Price,o={id:i.data.productId,packId:0,EAN:i.data.items[0].ean,requestedQuantity:1,pricesOriginal:{listPrice:e,netPrice:t},pricesFormatted:{listPrice:e.toString().replace(".",""),netPrice:t.toString().replace(".","")},discountType:"L"};window.orionLocalStorage.setItem("dagCurrentProductPBM",JSON.stringify(o),120),i.consultDiscountIntegration(n,o)}})},consultDiscountIntegration:async(e,t)=>{var e={cpf:e,product:t},t=await i.requestListDiscounts(e);"H119"==t.responseCode?(i.pbmFront.showLoading.hide(),e={url:t.urlTerms,text:t.message},i.showAcceptTermsModal(e)):"Q294"==t.responseCode||"Q295"==t.responseCode?(i.pbmFront.showLoading.hide(),localStorage.setItem("dagCentralNumber",t.centralNumber),swal({title:"Termos aceitos!",text:t.message,icon:"success",closeOnClickOutside:!1}).then(()=>{window.location.pathname="/cadastro-programa"})):"H127"==t.responseCode?(i.pbmFront.showLoading.hide(),swal({title:"Atenção",text:"Este canal não permite adesão. Faça a adesão através do 0800 707 1080 ou www.valemaissaude.com.br.",icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()})):"N000"==t.responseCode||"W003"==t.responseCode?(i.renderListDiscountsPrices(t.listPrices),i.pbmFront.showLoading.hide(),i.pbmFront.showListDiscountsPrices.show()):"Q542"==t.responseCode?(i.pbmFront.showLoading.hide(),swal({title:"Atenção",text:"Venda deste programa não liberada neste canal de vendas.",icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()})):t&&"401"==t.responseCode&&(i.pbmFront.showLoading.hide(),$.removeCookie("dagInterplayersToken"),$.removeCookie("dagInterplayersToken_expiration"),i.verifyToken(),swal({title:"Atenção",text:"Navegação expirada. Gerando um novo token.",icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()}))},renderListDiscountsPrices:e=>{let t=$(".pbm-list-discounts-prices-wrapper"),o="";e.forEach(function(e){e=`
                        <div class="pbm-list-discounts-prices" data-price="${e.price}" data-quantity="${e.quantity}">
                            <span class="pbm-list-discounts-prices--check"></span>
                            <span class="pbm-list-discounts-prices--unity">${e.quantity} UN.</span>
                            <span class="pbm-list-discounts-prices--value">${e.priceFormatted}</span>
                        </div>`;o+=e}),t.html(o),i.applySelectFieldsDiscounts()},applySelectFieldsDiscounts:()=>{$(".pbm-list-discounts-prices-wrapper .pbm-list-discounts-prices").on("click",function(e){e.preventDefault();let t=$(this);t.siblings().removeClass("price-discount-selected"),t.addClass("price-discount-selected")})},applySelectedDiscount:()=>{$("#pbm-btn-apply-discount").on("click",async function(r){if(r.preventDefault(),$(".pbm-list-discounts-prices-wrapper .pbm-list-discounts-prices").is(".price-discount-selected")){i.pbmFront.showListDiscountsPrices.hide(),i.pbmFront.showLoading.show();let e=$(".pbm-list-discounts-prices-wrapper .pbm-list-discounts-prices.price-discount-selected"),t=e.attr("data-price"),o=e.attr("data-quantity"),n=localStorage.getItem("dagCurrentProductPBM"),a=((n=JSON.parse(n)).pricesOriginal.listPrice=t,n.pricesOriginal.netPrice=t,n.pricesFormatted.listPrice=t.toString().replace(".",""),n.pricesFormatted.netPrice=t.toString().replace(".",""),n.requestedQuantity=o,[]);(orionLocalStorage.getItem("dagCurrentCart")?a=JSON.parse(localStorage.getItem("dagCurrentCart")).consultList:a).push(n);r={cpf:localStorage.getItem("dagUserCPF"),consultList:a},r=await i.requestSendProductCart(r);if("N000"==r.returnCode){if(console.log("Total de produtos: ",a.length),1==a.length){var s={cpf:localStorage.getItem("dagUserCPF"),consultList:a,responseCart:r};window.orionLocalStorage.setItem("dagCurrentCart",JSON.stringify(s),120)}else{let e=JSON.parse(localStorage.getItem("dagCurrentCart"))||null;if(null==e)return void alert("Atenção! Carrinho vazio.");e.consultList=a,e.responseCart=r,window.orionLocalStorage.setItem("dagCurrentCart",JSON.stringify(e),120)}window.orionLocalStorage.setItem("dagCurrentProductPBM",JSON.stringify(n),120);s={id:n.id,qtt:o,price:n.pricesFormatted.netPrice};i.addProductInCart(s)}else console.log("Status: ",r.status),console.log(r.data)}else alert("Atenção! Você deve selecionar um produto com desconto.")})},addProductInCart:o=>{var e={id:skuJson.skus[0].sku,quantity:o.qtt,seller:"1"};vtexjs.checkout.addToCart([e],null).done(function(e){var t;null!=e.items&&0!=e.items.length&&(t=e.items.find(e=>e.productId==skuJson.productId))&&null!=t&&(t=e.items.findIndex(e=>e.productId==o.id),$.ajax({type:"POST",url:i.routes.changePrice,data:{id:e.orderFormId,index:t,price:o.price}}).done(function(e){i.pbmFront.showLoading.hide(),i.pbmFront.showLoadingComplete.show(),setTimeout(function(){i.pbmFront.showLoadingComplete.hide(),i.pbmFront.showDiscountActivated.show(),setTimeout(function(){window.location.reload()},500)},2e3)}))})},showAcceptTermsModal:e=>{var t=`<iframe src="${e.url}"></iframe>`;$(".dag-terms-modal.block-terms-info").html(`<p>${e.text}</p>`),$(".dag-terms-modal.block-terms").html($(t)),$(document.body).addClass("term-modal-on")},closeAcceptModal:()=>{$("#dag-btn-terms-modal-reload").on("click",function(e){e.preventDefault(),window.location.reload()})},removeDiscountApplied:()=>{$("#pbm-prod-btn-remove-discount").on("click",function(e){e.preventDefault(),i.pbmFront.showDiscountActivated.hide(),i.pbmFront.showLoading.show(),vtexjs.checkout.getOrderForm().then(function(e){let n=[],t=JSON.parse(localStorage.getItem("dagCurrentCart"));return e.items.forEach(o=>{t.consultList.forEach((e,t)=>{o.productId==e.id&&n.push({index:t,quantity:0})})}),vtexjs.checkout.removeItems(n)}).done(function(e){i.clearDiscountAndCart(),setTimeout(function(){i.pbmFront.showLoading.hide(),i.pbmFront.showDefaultDiscount.show(),setTimeout(function(){window.location.reload()},500)},1e3)})})},pbmFront:{showDefaultDiscount:{show:function(){$(".pbm-standard-discount").addClass("standard-discount-on")},hide:function(){$(".pbm-standard-discount").removeClass("standard-discount-on")}},showFieldCPF:{show:function(){$(".pbm-document-field").addClass("document-field-on")},hide:function(){$(".pbm-document-field").removeClass("document-field-on")}},showDiscountActivated:{show:function(){$(".pbm-discount-activated").addClass("discount-activated-on")},hide:function(){$(".pbm-discount-activated").removeClass("discount-activated-on")}},showListDiscountsPrices:{show:function(){$(".pbm-list-discounts").addClass("list-discounts-on")},hide:function(){$(".pbm-list-discounts").removeClass("list-discounts-on")}},showLoading:{show:function(){$(".pbm-prod-loader").addClass("pbm-loader-on")},hide:function(){$(".pbm-prod-loader").removeClass("pbm-loader-on")}},showLoadingComplete:{show:function(){$(".pbm-prod-discount-applied").addClass("discount-applied-on")},hide:function(){$(".pbm-prod-discount-applied").removeClass("discount-applied-on")}}},requestGenerateToken:()=>$.ajax({type:"POST",url:i.routes.getToken,data:{Client_Id:"36C0ED06-5F33-448C-96E4-A5AE1AAD3142",Client_Secret:"VP2TQfEL#mF3!rsW",Grant_Type:"client_credentials"}}),requestProductData:()=>$.ajax({type:"GET",url:i.routes.prodData+skuJson.productId,dataType:"json",contentType:"application/json",headers:{"Content-Type":"application/json",Accept:"application/vnd.vtex.ds.v10+json"}}),requestListDiscounts:e=>$.ajax({type:"POST",url:i.routes.getListDiscounts,data:e}),requestSendProductCart:e=>$.ajax({type:"POST",url:i.routes.getCart,data:e}),clearDiscountAndCart:()=>{localStorage.removeItem("dagCurrentCart"),localStorage.removeItem("dagCurrentCart_expiration"),localStorage.removeItem("dagCurrentProductPBM"),localStorage.removeItem("dagCurrentProductPBM_expiration")},applyMaskCPF:()=>{$("#pbm-prod-input-cpf").mask("000.000.000-00",{reverse:!0})},getProductIndexOrderForm:e=>{if(!e)return!1;let t=JSON.parse(localStorage.getItem("dagCurrentCart"))||null;if(!t)return!1;let o=e.findIndex(e=>e.productId==t.consultList.id);return isNaN(o)?"false":0==o?"zero":o.toString()},getIndexProductPBM:()=>{},getCurrentProductPBM:()=>!!orionLocalStorage.getItem("dagCurrentProductPBM")&&JSON.parse(localStorage.getItem("dagCurrentProductPBM")),dateConverterToBrazilTimezone:e=>{let t=new Date;e=(t=e?new Date(t.getTime()+18e5):t).getFullYear().toString()+"-";return(e=(e=(e=(e+=(t.getMonth()+1).toString().padStart(2,"0")+"-")+(t.getDate().toString().padStart(2,"0")+"T"))+(t.getHours().toString().padStart(2,"0")+":"))+(t.getMinutes().toString().padStart(2,"0")+":"))+t.getSeconds().toString().padStart(2,"0")}};$(document).ready(i.init);$(window).load(function(){i.windowOnload()}),$(document).ajaxStop(i.ajaxStop)}catch(e){console.log("Erro na instância do [PBMproduct]: ",e)}}();