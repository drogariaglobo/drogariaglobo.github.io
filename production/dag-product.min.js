!function(){try{var t="https://drogariaglobo-middleware.herokuapp.com";let i={init:()=>{i.verifyStatusDiscount(),i.getProductData(),i.pbmAllEvents(),i.applyMaskCPF(),i.closeAcceptModal(),i.applySelectedDiscount(),i.removeDiscountApplied()},windowOnload:()=>{},ajaxStop:()=>{},pbmSpecData:null,routes:{prodData:"/api/catalog_system/pub/products/search/?fq=productId:",getListDiscounts:t+"/middleware/v1/prices-discounts",getCart:t+"/middleware/v1/cart",changePrice:t+"/middleware/v1/change-price-vtex"},verifyStatusDiscount:()=>{var t;localStorage.getItem("dagUserCPF")&&(t=localStorage.getItem("dagUserCPF"),$("#pbm-prod-input-cpf").val(t)),orionLocalStorage.getItem("dagCurrentCart")&&JSON.parse(localStorage.getItem("dagCurrentCart")).consultList.find(t=>t.id==skuJson.productId)?($(".product-right__buy-button").hide(),$(".pbm-discount-activated").addClass("discount-activated-on")):$(".pbm-standard-discount").addClass("standard-discount-on")},getProductData:async()=>{var t=await i.requestProductData();i.data=t[0],i.checkingIfHasPBM(i.data)},checkingIfHasPBM:t=>{t.productPbmOn&&t.productPbmOn&&"S"==t.productPbmOn&&(t.formattedPrice&&t.standardPrice?(i.pbmSpecData={requestHolderId:t.requestHolderId[0],productPbmOn:t.productPbmOn[0],requestCoupon:t.requestCoupon[0],eanCombos:t.eanCombos[0],industryName:t.industryName[0],todayTableId:t.todayTableId[0],formattedPrice:t.formattedPrice[0],standardPrice:t.standardPrice[0]},$(".pbm-prod-price").text(i.pbmSpecData.standardPrice),$(".pbm-prod-discount-activated-text").text(i.pbmSpecData.industryName)):$(".dag-product.pbm").hide())},pbmAllEvents:()=>{let s=$(".pbm-document-field");$(".pbm-standard-discount").on("click",function(t){t.preventDefault(),i.pbmFront.showDefaultDiscount.hide(),i.pbmFront.showFieldCPF.show()}),$(".pbm-list-discounts-finded--remove").on("click",function(t){t.preventDefault(),$("#pbm-prod-input-cpf").val(""),i.pbmFront.showListDiscountsPrices.hide(),i.pbmFront.showDefaultDiscount.show()}),$("#pbm-prod-btn-cpf-add").on("click",function(t){t.preventDefault();let r=$("#pbm-prod-input-cpf").val();if(r.length<14)alert("CPF Incompleto.");else{s.removeClass("document-field-on"),i.pbmFront.showLoading.show(),r=r.replace(/[^\w\s]/g,""),window.orionLocalStorage.setItem("dagUserCPF",r,120);let t=i.data.items[0].sellers[0].commertialOffer.ListPrice,e=i.data.items[0].sellers[0].commertialOffer.Price,o={id:i.data.productId,packId:0,EAN:i.data.items[0].ean,requestedQuantity:1,pricesOriginal:{listPrice:t,netPrice:e},pricesFormatted:{listPrice:t.toString().replace(".",""),netPrice:e.toString().replace(".","")},discountType:"L"};window.orionLocalStorage.setItem("dagCurrentProductPBM",JSON.stringify(o),120),i.consultDiscountIntegration(r,o)}})},consultDiscountIntegration:async(t,e)=>{var t={cpf:t,product:e},e=await i.requestListDiscounts(t);"H119"==e.responseCode||"H120"==e.responseCode?(i.pbmFront.showLoading.hide(),t={url:e.urlTerms,text:e.message},i.showAcceptTermsModal(t)):"Q294"==e.responseCode||"Q295"==e.responseCode?(i.pbmFront.showLoading.hide(),localStorage.setItem("dagCentralNumber",e.centralNumber),swal({title:"Termos aceitos!",text:e.message,icon:"success",closeOnClickOutside:!1}).then(()=>{window.location.pathname="/cadastro-programa"})):"H127"==e.responseCode?(i.pbmFront.showLoading.hide(),swal({title:"Atenção",text:"Este canal não permite adesão. Faça a adesão através do 0800 707 1080 ou www.valemaissaude.com.br.",icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()})):"N000"==e.responseCode||"W003"==e.responseCode?(i.renderListDiscountsPrices(e.listPrices),i.pbmFront.showLoading.hide(),i.pbmFront.showListDiscountsPrices.show()):e&&e.interplayersError&&(console.log("ALERTA INTERPLAYERS!"),i.interplayersErrors(e))},renderListDiscountsPrices:t=>{let e=$(".pbm-list-discounts-prices-wrapper"),o=$(".pbm-list-discounts-finded--value"),r=$(".pbm-list-discounts-current-price--value"),s="";t.forEach(function(t){t=`
                        <div class="pbm-list-discounts-prices" data-price="${t.price}" data-quantity="${t.quantity}">
                            <span class="pbm-list-discounts-prices--check"></span>
                            <span class="pbm-list-discounts-prices--unity">${t.quantity} UN.</span>
                            <span class="pbm-list-discounts-prices--value">${t.priceFormatted}</span>
                        </div>`;s+=t}),1==t.length?o.text(t.length+" desconto"):o.text(t.length+" descontos");t=$(".skuBestPrice").text();r.text(t),e.html(s),i.applySelectFieldsDiscounts()},applySelectFieldsDiscounts:()=>{$(".pbm-list-discounts-prices-wrapper .pbm-list-discounts-prices").on("click",function(t){t.preventDefault();let e=$(this);e.siblings().removeClass("price-discount-selected"),e.addClass("price-discount-selected")})},applySelectedDiscount:()=>{$("#pbm-btn-apply-discount").on("click",async function(a){if(a.preventDefault(),$(".pbm-list-discounts-prices-wrapper .pbm-list-discounts-prices").is(".price-discount-selected")){i.pbmFront.showListDiscountsPrices.hide(),i.pbmFront.showLoading.show();let t=$(".pbm-list-discounts-prices-wrapper .pbm-list-discounts-prices.price-discount-selected"),e=t.attr("data-price"),o=t.attr("data-quantity"),r=localStorage.getItem("dagCurrentProductPBM"),s=((r=JSON.parse(r)).pricesOriginal.listPrice=e,r.pricesOriginal.netPrice=e,r.pricesFormatted.listPrice=e.toString().replace(".",""),r.pricesFormatted.netPrice=e.toString().replace(".",""),r.requestedQuantity=o,[]);(orionLocalStorage.getItem("dagCurrentCart")?s=JSON.parse(localStorage.getItem("dagCurrentCart")).consultList:s).push(r);a={cpf:localStorage.getItem("dagUserCPF"),consultList:s},a=await i.requestSendProductCart(a);if("N000"==a.returnCode){if(1==s.length){var n={cpf:localStorage.getItem("dagUserCPF"),consultList:s,responseCart:a};window.orionLocalStorage.setItem("dagCurrentCart",JSON.stringify(n),120)}else{let t=JSON.parse(localStorage.getItem("dagCurrentCart"))||null;if(null==t)return void alert("Atenção! Carrinho vazio.");t.consultList=s,t.responseCart=a,window.orionLocalStorage.setItem("dagCurrentCart",JSON.stringify(t),120)}window.orionLocalStorage.setItem("dagCurrentProductPBM",JSON.stringify(r),120);n={id:r.id,qtt:o,price:r.pricesFormatted.netPrice};i.addProductInCart(n)}else"A001"==a.returnCode?i.alertError(a):(console.log("Erro ao colocar no carrinho"),console.log(a))}else alert("Atenção! Você deve selecionar um produto com desconto.")})},addProductInCart:o=>{var t={id:skuJson.skus[0].sku,quantity:o.qtt,seller:"1"};vtexjs.checkout.addToCart([t],null).done(function(t){var e;null!=t.items&&0!=t.items.length&&(e=t.items.find(t=>t.productId==skuJson.productId))&&null!=e&&(e=t.items.findIndex(t=>t.productId==o.id),$.ajax({type:"POST",url:i.routes.changePrice,data:{id:t.orderFormId,index:e,price:o.price}}).done(function(t){i.pbmFront.showLoading.hide(),i.pbmFront.showLoadingComplete.show(),setTimeout(function(){i.pbmFront.showLoadingComplete.hide(),i.pbmFront.showDiscountActivated.show(),setTimeout(function(){window.location.reload()},500)},2e3)}))})},showAcceptTermsModal:t=>{var e=`<iframe src="${t.url}"></iframe>`;$(".dag-terms-modal.block-terms-info").html(`<p>${t.text}</p>`),$(".dag-terms-modal.block-terms").html($(e)),$(document.body).addClass("term-modal-on")},closeAcceptModal:()=>{$("#dag-btn-terms-modal-reload").on("click",function(t){t.preventDefault(),window.location.reload()})},removeDiscountApplied:()=>{$("#pbm-prod-btn-remove-discount").on("click",function(t){t.preventDefault(),i.pbmFront.showDiscountActivated.hide(),i.pbmFront.showLoading.show(),vtexjs.checkout.getOrderForm().then(function(t){let r=[],e=JSON.parse(localStorage.getItem("dagCurrentCart"));return t.items.forEach(o=>{e.consultList.forEach((t,e)=>{o.productId==t.id&&r.push({index:e,quantity:0})})}),vtexjs.checkout.removeItems(r)}).done(function(t){i.clearDiscountAndCart(),setTimeout(function(){i.pbmFront.showLoading.hide(),i.pbmFront.showDefaultDiscount.show(),setTimeout(function(){window.location.reload()},500)},1e3)})})},pbmFront:{showDefaultDiscount:{show:function(){$(".pbm-standard-discount").addClass("standard-discount-on")},hide:function(){$(".pbm-standard-discount").removeClass("standard-discount-on")}},showFieldCPF:{show:function(){$(".pbm-document-field").addClass("document-field-on")},hide:function(){$(".pbm-document-field").removeClass("document-field-on")}},showDiscountActivated:{show:function(){$(".pbm-discount-activated").addClass("discount-activated-on")},hide:function(){$(".pbm-discount-activated").removeClass("discount-activated-on")}},showListDiscountsPrices:{show:function(){$(".pbm-list-discounts").addClass("list-discounts-on")},hide:function(){$(".pbm-list-discounts").removeClass("list-discounts-on")}},showLoading:{show:function(){$(".pbm-prod-loader").addClass("pbm-loader-on")},hide:function(){$(".pbm-prod-loader").removeClass("pbm-loader-on")}},showLoadingComplete:{show:function(){$(".pbm-prod-discount-applied").addClass("discount-applied-on")},hide:function(){$(".pbm-prod-discount-applied").removeClass("discount-applied-on")}}},requestProductData:()=>$.ajax({type:"GET",url:i.routes.prodData+skuJson.productId,dataType:"json",contentType:"application/json",headers:{"Content-Type":"application/json",Accept:"application/vnd.vtex.ds.v10+json"}}),requestListDiscounts:t=>$.ajax({type:"POST",url:i.routes.getListDiscounts,data:t}),requestSendProductCart:t=>$.ajax({type:"POST",url:i.routes.getCart,data:t}),interplayersErrors:t=>{"Q542"!=t.responseCode&&"Q563"!=t.responseCode&&"QG43"!=t.responseCode||i.alertError(t)},alertError:t=>{i.pbmFront.showLoading.hide(),swal({title:"Atenção",text:t.message,icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()})},clearDiscountAndCart:()=>{localStorage.removeItem("dagCurrentCart"),localStorage.removeItem("dagCurrentCart_expiration"),localStorage.removeItem("dagCurrentProductPBM"),localStorage.removeItem("dagCurrentProductPBM_expiration")},applyMaskCPF:()=>{$("#pbm-prod-input-cpf").mask("000.000.000-00",{reverse:!0})},getProductIndexOrderForm:t=>{if(!t)return!1;let e=JSON.parse(localStorage.getItem("dagCurrentCart"))||null;if(!e)return!1;let o=t.findIndex(t=>t.productId==e.consultList.id);return isNaN(o)?"false":0==o?"zero":o.toString()},getIndexProductPBM:()=>{},getCurrentProductPBM:()=>!!orionLocalStorage.getItem("dagCurrentProductPBM")&&JSON.parse(localStorage.getItem("dagCurrentProductPBM")),dateConverterToBrazilTimezone:t=>{let e=new Date;t=(e=t?new Date(e.getTime()+18e5):e).getFullYear().toString()+"-";return(t=(t=(t=(t+=(e.getMonth()+1).toString().padStart(2,"0")+"-")+(e.getDate().toString().padStart(2,"0")+"T"))+(e.getHours().toString().padStart(2,"0")+":"))+(e.getMinutes().toString().padStart(2,"0")+":"))+e.getSeconds().toString().padStart(2,"0")}};$(document).ready(i.init);$(window).load(function(){i.windowOnload()}),$(document).ajaxStop(i.ajaxStop)}catch(t){console.log("Erro na instância do [PBMproduct]: ",t)}}();