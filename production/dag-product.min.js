!function(){try{var t="https://drogariaglobo-middleware.herokuapp.com";let s={init:()=>{s.verifyToken(),s.verifyStatusDiscount(),s.getProductData(),s.pbmAllEvents(),s.applyMaskCPF(),s.closeAcceptModal(),s.applySelectedDiscount()},windowOnload:()=>{},ajaxStop:()=>{},data:null,pbmSpecData:null,routes:{prodData:"/api/catalog_system/pub/products/search/?fq=productId:",getToken:"https://api-mng.interplayers.com.br/gip-scs-svc/token",getListDiscounts:t+"/middleware/v1/prices-discounts",getCart:t+"/middleware/v1/update-cart"},verifyToken:async()=>{if($.cookie("dagInterplayersToken")){var e=$.cookie("dagInterplayersToken_expiration"),e=new Date(e);if(new Date<e)return void console.log("Token ativo.");$.removeCookie("dagInterplayersToken"),$.removeCookie("dagInterplayersToken_expiration")}e=await s.requestGenerateToken();if(e&&e.access_token){console.log("Novo token");let t=s.dateConverterToBrazilTimezone(!0);$.cookie("dagInterplayersToken",e.access_token,{expires:1}),$.cookie("dagInterplayersToken_expiration",t.toString(),{expires:1})}},verifyStatusDiscount:()=>{orionLocalStorage.getItem("dagCurrentDiscountActivatedSeted")?$(".pbm-discount-activated").addClass("discount-activated-on"):$(".pbm-standard-discount").addClass("standard-discount-on")},getProductData:async()=>{var t=await s.requestProductData();s.data=t[0],s.checkingIfHasPBM(s.data)},checkingIfHasPBM:t=>{t.productPbmOn&&t.productPbmOn&&"S"==t.productPbmOn&&(s.pbmSpecData={requestHolderId:t.requestHolderId[0],productPbmOn:t.productPbmOn[0],requestCoupon:t.requestCoupon[0],eanCombos:t.eanCombos[0],industryName:t.industryName[0],todayTableId:t.todayTableId[0],formattedPrice:t.formattedPrice[0],standardPrice:t.standardPrice[0]},$(".pbm-prod-price").text(s.pbmSpecData.standardPrice),$(".pbm-prod-discount-activated-text").text(s.pbmSpecData.industryName))},pbmAllEvents:()=>{let n=$(".pbm-document-field");$(".pbm-standard-discount").on("click",function(t){t.preventDefault(),s.pbmFront.showDefaultDiscount.hide(),s.pbmFront.showFieldCPF.show()}),$(".pbm-list-discounts-finded--remove").on("click",function(t){t.preventDefault(),s.pbmFront.showListDiscountsPrices.hide(),s.pbmFront.showDefaultDiscount.show()}),$("#pbm-prod-btn-remove-discount").on("click",function(t){t.preventDefault(),s.pbmFront.showDiscountActivated.hide(),s.pbmFront.showLoading.show(),s.clearDiscountAndCart(),setTimeout(function(){s.pbmFront.showLoading.hide(),s.pbmFront.showDefaultDiscount.show()},1e3)}),$("#pbm-prod-btn-cpf-add").on("click",function(t){t.preventDefault();let a=$("#pbm-prod-input-cpf").val();if(a.length<14)alert("CPF Incompleto.");else{n.removeClass("document-field-on"),s.pbmFront.showLoading.show(),a=a.replace(/[^\w\s]/g,""),window.orionLocalStorage.setItem("dagUserCPF",a,120);let t=s.data.items[0].sellers[0].commertialOffer.ListPrice,e=s.data.items[0].sellers[0].commertialOffer.Price,o={id:s.data.productId,packId:0,EAN:s.data.items[0].ean,requestedQuantity:1,pricesOriginal:{listPrice:t,netPrice:e},pricesFormatted:{listPrice:t.toString().replace(".",""),netPrice:e.toString().replace(".","")},discountType:"L"};window.orionLocalStorage.setItem("dagCurrentProductPBM",JSON.stringify(o),120),s.consultDiscountIntegration(a,o)}})},consultDiscountIntegration:async(t,e)=>{var t={cpf:t,product:e},e=await s.requestListDiscounts(t);"H119"==e.responseCode?(s.pbmFront.showLoading.hide(),t={url:e.urlTerms,text:e.message},s.showAcceptTermsModal(t)):"Q294"==e.responseCode?(s.pbmFront.showLoading.hide(),localStorage.setItem("dagCentralNumber",e.centralNumber),swal({title:"Termos aceitos!",text:"Agora o proximo passo é realizar seu cadastro, redirecionando para o formulario.",icon:"success",closeOnClickOutside:!1}).then(()=>{window.location.pathname="/cadastro-programa"})):"H127"==e.responseCode?(s.pbmFront.showLoading.hide(),swal({title:"Atenção",text:e.informativeText,icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()})):"N000"==e.responseCode?(s.renderListDiscountsPrices(e.listPrices),s.pbmFront.showLoading.hide(),s.pbmFront.showListDiscountsPrices.show()):e&&"401"==e.responseCode&&(s.pbmFront.showLoading.hide(),$.removeCookie("dagInterplayersToken"),$.removeCookie("dagInterplayersToken_expiration"),s.verifyToken(),swal({title:"Atenção",text:"Navegação expirada. Gerando um novo token.",icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()}))},renderListDiscountsPrices:t=>{let e=$(".pbm-list-discounts-prices-wrapper"),o="";t.forEach(function(t){t=`
                        <div class="pbm-list-discounts-prices" data-price="${t.price}" data-quantity="${t.quantity}">
                            <span class="pbm-list-discounts-prices--check"></span>
                            <span class="pbm-list-discounts-prices--unity">${t.quantity} UN.</span>
                            <span class="pbm-list-discounts-prices--value">${t.priceFormatted}</span>
                        </div>`;o+=t}),e.html(o),s.applySelectFieldsDiscounts()},applySelectFieldsDiscounts:()=>{$(".pbm-list-discounts-prices-wrapper .pbm-list-discounts-prices").on("click",function(t){t.preventDefault();let e=$(this);e.siblings().removeClass("price-discount-selected"),e.addClass("price-discount-selected")})},applySelectedDiscount:()=>{$("#pbm-btn-apply-discount").on("click",async function(n){if(n.preventDefault(),$(".pbm-list-discounts-prices-wrapper .pbm-list-discounts-prices").is(".price-discount-selected")){s.pbmFront.showListDiscountsPrices.hide(),s.pbmFront.showLoading.show();let t=$(".pbm-list-discounts-prices-wrapper .pbm-list-discounts-prices.price-discount-selected"),e=t.attr("data-price"),o=t.attr("data-quantity"),a=localStorage.getItem("dagCurrentProductPBM");(a=JSON.parse(a)).pricesOriginal.listPrice=e,a.pricesOriginal.netPrice=e,a.pricesFormatted.listPrice=e.toString().replace(".",""),a.pricesFormatted.netPrice=e.toString().replace(".",""),a.requestedQuantity=o;var r,n={cpf:localStorage.getItem("dagUserCPF"),product:a},n=await s.requestSendProductCart(n);"N000"==n.returnCode?(r={productId:a.id,transactionCode:n.transaction.transactionCode},window.orionLocalStorage.setItem("dagCurrentDiscountActivatedSeted",!0,120),window.orionLocalStorage.setItem("dagCurrentProductPBM",JSON.stringify(a),120),window.orionLocalStorage.setItem("dagCartPBM",JSON.stringify(r),120),s.pbmFront.showLoading.hide(),s.pbmFront.showLoadingComplete.show(),setTimeout(function(){s.pbmFront.showLoadingComplete.hide(),s.pbmFront.showDiscountActivated.show()},1200)):(console.log("Status: ",n.status),console.log(n.data))}else alert("Você deve selecionar um desconto.")})},showAcceptTermsModal:t=>{var e=`<iframe src="${t.url}"></iframe>`;$(".dag-terms-modal.block-terms-info").html(`<p>${t.text}</p>`),$(".dag-terms-modal.block-terms").html($(e)),$(document.body).addClass("term-modal-on")},closeAcceptModal:()=>{$("#dag-btn-terms-modal-reload").on("click",function(t){t.preventDefault(),window.location.reload()})},pbmFront:{showDefaultDiscount:{show:function(){$(".pbm-standard-discount").addClass("standard-discount-on")},hide:function(){$(".pbm-standard-discount").removeClass("standard-discount-on")}},showFieldCPF:{show:function(){$(".pbm-document-field").addClass("document-field-on")},hide:function(){$(".pbm-document-field").removeClass("document-field-on")}},showDiscountActivated:{show:function(){$(".pbm-discount-activated").addClass("discount-activated-on")},hide:function(){$(".pbm-discount-activated").removeClass("discount-activated-on")}},showListDiscountsPrices:{show:function(){$(".pbm-list-discounts").addClass("list-discounts-on")},hide:function(){$(".pbm-list-discounts").removeClass("list-discounts-on")}},showLoading:{show:function(){$(".pbm-prod-loader").addClass("pbm-loader-on")},hide:function(){$(".pbm-prod-loader").removeClass("pbm-loader-on")}},showLoadingComplete:{show:function(){$(".pbm-prod-discount-applied").addClass("discount-applied-on")},hide:function(){$(".pbm-prod-discount-applied").removeClass("discount-applied-on")}}},changePrice:()=>{var t=vtexjs.checkout.orderForm.orderFormId;return $.ajax({type:"POST",url:`/api/checkout/pub/orderForm/${t}/items/0/price`,data:bodyRequest})},requestGenerateToken:()=>$.ajax({type:"POST",url:s.routes.getToken,data:{Client_Id:"36C0ED06-5F33-448C-96E4-A5AE1AAD3142",Client_Secret:"VP2TQfEL#mF3!rsW",Grant_Type:"client_credentials"}}),requestProductData:()=>$.ajax({type:"GET",url:s.routes.prodData+skuJson.productId,dataType:"json",contentType:"application/json",headers:{"Content-Type":"application/json",Accept:"application/vnd.vtex.ds.v10+json"}}),requestListDiscounts:t=>$.ajax({type:"POST",url:s.routes.getListDiscounts,data:t}),requestSendProductCart:t=>$.ajax({type:"POST",url:s.routes.getCart,data:t}),clearDiscountAndCart:()=>{localStorage.removeItem("dagCartPBM"),localStorage.removeItem("dagCartPBM_expiration"),localStorage.removeItem("dagCurrentProductPBM"),localStorage.removeItem("dagCurrentProductPBM_expiration"),localStorage.removeItem("dagCurrentDiscountActivatedSeted"),localStorage.removeItem("dagCurrentDiscountActivatedSeted_expiration")},applyMaskCPF:()=>{$("#pbm-prod-input-cpf").mask("000.000.000-00",{reverse:!0})},productIndexOrderForm:()=>{vtexjs.checkout.getOrderForm().done(function(a){if(null!=a.items&&0!=a.items.length&&localStorage.getItem("dagCurrentProductPBM")){let e=JSON.parse(localStorage.getItem("dagCurrentProductPBM")),t=a.items,o=t.find(t=>t.productId==e.id);return o&&null!=o?t.findIndex(t=>t.productId==e.id):void 0}})},dateConverterToBrazilTimezone:t=>{let e=new Date;t=(e=t?new Date(e.getTime()+18e5):e).getFullYear().toString()+"-";return(t=(t=(t=(t+=(e.getMonth()+1).toString().padStart(2,"0")+"-")+(e.getDate().toString().padStart(2,"0")+"T"))+(e.getHours().toString().padStart(2,"0")+":"))+(e.getMinutes().toString().padStart(2,"0")+":"))+e.getSeconds().toString().padStart(2,"0")}};$(document).ready(s.init);$(window).load(function(){s.windowOnload()}),$(document).ajaxStop(s.ajaxStop)}catch(t){console.log("Erro na instância do [PBMproduct]: ",t)}}();