!function(){try{var e="https://drogariaglobo-middleware.herokuapp.com";let s={init:()=>{s.verifyToken(),s.getProductData(),s.pbmAllEvents(),s.applyMaskCPF(),s.selectDiscountValue(),s.closeAcceptModal()},windowOnload:()=>{},ajaxStop:()=>{},data:null,pbmSpecData:null,routes:{prodData:"/api/catalog_system/pub/products/search/?fq=productId:",getToken:"https://api-mng.interplayers.com.br/gip-scs-svc/token",getConsultDiscount:e+"/dagmiddleware/consult-discount",getListDiscounts:e+"/dagmiddleware/prices-discounts"},verifyToken:async()=>{if($.cookie("dagInterplayersToken")){var t=$.cookie("dagInterplayersToken_expiration"),t=new Date(t);if(new Date<t)return void console.log("Token ativo.");$.removeCookie("dagInterplayersToken"),$.removeCookie("dagInterplayersToken_expiration")}t=await s.requestGenerateToken();if(t&&t.access_token){console.log("Novo token");let e=s.dateConverterToBrazilTimezone(!0);$.cookie("dagInterplayersToken",t.access_token,{expires:1}),$.cookie("dagInterplayersToken_expiration",e.toString(),{expires:1})}},getProductData:async()=>{var e=await s.requestProductData();s.data=e[0],s.checkingIfHasPBM(s.data)},checkingIfHasPBM:e=>{e.productPbmOn&&e.productPbmOn&&"S"==e.productPbmOn&&(s.pbmSpecData={requestHolderId:e.requestHolderId[0],productPbmOn:e.productPbmOn[0],requestCoupon:e.requestCoupon[0],eanCombos:e.eanCombos[0],industryName:e.industryName[0],todayTableId:e.todayTableId[0],formattedPrice:e.formattedPrice[0],standardPrice:e.standardPrice[0]},$(".pbm-prod-price").text(s.pbmSpecData.standardPrice))},pbmAllEvents:()=>{let n=$(".pbm-document-field");$(".pbm-standard-discount").on("click",function(e){e.preventDefault(),s.pbmFront.showDefaultDiscount.hide(),s.pbmFront.showFieldCPF.show()}),$(".pbm-list-discounts-finded--remove").on("click",function(e){e.preventDefault(),s.pbmFront.showListDiscountsPrices.hide(),s.pbmFront.showDefaultDiscount.show()}),$("#pbm-prod-btn-cpf-add").on("click",function(e){e.preventDefault();let t=$("#pbm-prod-input-cpf").val();var o;t.length<14?alert("CPF Incompleto."):(n.removeClass("document-field-on"),s.pbmFront.showLoading.show(),t=t.replace(/[^\w\s]/g,""),e=s.data.items[0].sellers[0].commertialOffer.ListPrice.toString().replace(".",""),o=s.data.items[0].sellers[0].commertialOffer.Price.toString().replace(".",""),e={id:s.data.productId,packId:0,EAN:s.data.items[0].ean,requestedQuantity:1,listPrice:e,netPrice:o,discountType:"L"},s.data.productId,s.data.items[0].ean,s.consultDiscountIntegration(t,e))})},consultDiscountIntegration:async(e,t)=>{var e={cpf:e,product:t,token:$.cookie("dagInterplayersToken")},t=await s.requestListDiscounts(e);"H119"==t.responseCode?(s.pbmFront.showLoading.hide(),e={url:t.urlTerms,text:t.message},s.showAcceptTermsModal(e)):"Q294"==t.responseCode?(s.pbmFront.showLoading.hide(),localStorage.setItem("dagCentralNumber",t.centralNumber),swal({title:"Termos aceitos!",text:"Agora o proximo passo é realizar seu cadastro, redirecionando para o formulario.",icon:"success",closeOnClickOutside:!1}).then(()=>{window.location.pathname="/cadastro-programa"})):"H127"==t.responseCode?(s.pbmFront.showLoading.hide(),swal({title:"Atenção",text:t.informativeText,icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()})):"N000"==t.responseCode?(s.renderListDiscountsPrices(t.listPrices),s.pbmFront.showLoading.hide(),s.pbmFront.showListDiscountsPrices.show()):t&&"401"==t.responseCode&&(s.pbmFront.showLoading.hide(),swal({title:"Atenção",text:"Navegação expirada. Gerando um novo token.",icon:"warning",closeOnClickOutside:!1}).then(()=>{window.location.reload()}))},renderListDiscountsPrices:e=>{let t=$(".pbm-list-discounts-prices-wrapper"),o="";e.forEach(function(e){console.log(e);e=`
                        <div class="pbm-list-discounts-prices">
                            <span class="pbm-list-discounts-prices--check"></span>
                            <span class="pbm-list-discounts-prices--unity">${e.quantity} UN.</span>
                            <span class="pbm-list-discounts-prices--value">${e.priceFormatted}</span>
                        </div>`;o+=e}),t.html(o)},selectDiscountValue:()=>{var e=$(".pbm-list-discounts-prices--check");$(document).on("click",e,function(e){e.preventDefault(),e.stopPropagation(),$(e.target).is(".pbm-list-discounts-prices--check")&&s.pbmFront.showLoading.show()})},showAcceptTermsModal:e=>{var t=`<iframe src="${e.url}"></iframe>`;$(".dag-terms-modal.block-terms-info").html(`<p>${e.text}</p>`),$(".dag-terms-modal.block-terms").html($(t)),$(document.body).addClass("term-modal-on")},closeAcceptModal:()=>{$("#dag-btn-terms-modal-reload").on("click",function(e){e.preventDefault(),window.location.reload()})},pbmFront:{showDefaultDiscount:{show:function(){$(".pbm-standard-discount").addClass("standard-discount-on")},hide:function(){$(".pbm-standard-discount").removeClass("standard-discount-on")}},showFieldCPF:{show:function(){$(".pbm-document-field").addClass("document-field-on")},hide:function(){$(".pbm-document-field").removeClass("document-field-on")}},showListDiscountsPrices:{show:function(){$(".pbm-list-discounts").addClass("list-discounts-on")},hide:function(){$(".pbm-list-discounts").removeClass("list-discounts-on")}},showCurrentDiscountActived:function(){},showLoading:{show:function(){$(".pbm-prod-loader").addClass("pbm-loader-on")},hide:function(){$(".pbm-prod-loader").removeClass("pbm-loader-on")}},showDiscountApplied:function(){$(".pbm-prod-discount-applied").addClass("discount-applied-on")}},requestGenerateToken:()=>$.ajax({type:"POST",url:s.routes.getToken,data:{Client_Id:"36C0ED06-5F33-448C-96E4-A5AE1AAD3142",Client_Secret:"VP2TQfEL#mF3!rsW",Grant_Type:"client_credentials"}}),requestProductData:()=>$.ajax({type:"GET",url:s.routes.prodData+skuJson.productId,dataType:"json",contentType:"application/json",headers:{"Content-Type":"application/json",Accept:"application/vnd.vtex.ds.v10+json"}}),requestConsultDiscount:e=>$.ajax({type:"POST",url:s.routes.getConsultDiscount,data:e}),requestListDiscounts:e=>$.ajax({type:"POST",url:s.routes.getListDiscounts,data:e}),applyMaskCPF:()=>{$("#pbm-prod-input-cpf").mask("000.000.000-00",{reverse:!0})},dateConverterToBrazilTimezone:e=>{let t=new Date;e=(t=e?new Date(t.getTime()+18e5):t).getFullYear().toString()+"-";return(e=(e=(e=(e+=(t.getMonth()+1).toString().padStart(2,"0")+"-")+(t.getDate().toString().padStart(2,"0")+"T"))+(t.getHours().toString().padStart(2,"0")+":"))+(t.getMinutes().toString().padStart(2,"0")+":"))+t.getSeconds().toString().padStart(2,"0")}};$(document).ready(s.init);$(window).load(function(){s.windowOnload()}),$(document).ajaxStop(s.ajaxStop)}catch(e){console.log("Erro na instância do [PBMproduct]: ",e)}}();