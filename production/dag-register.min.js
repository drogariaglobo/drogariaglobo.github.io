!function(){try{let i={init:()=>{i.getUserInfo(),i.applyValidate(),i.applyMaksInFields(),i.saveFormData(),i.applyFixCheckbox()},windowOnload:()=>{},ajaxStop:()=>{},dataUser:{id:null},getUserInfo:()=>{var e;localStorage.getItem("dagUserCPF")&&(e=localStorage.getItem("dagUserCPF"),localStorage.getItem("dagUserCard")&&$("#inputCard").val(localStorage.getItem("dagUserCard")),$.ajax({type:"GET",url:"/api/dataentities/FU/search?cpf="+e+"&_fields=allinfos&an=drogariaglobo",dataType:"json",contentType:"application/json",headers:{"Content-Type":"application/json",Accept:"application/vnd.vtex.ds.v10+json"}}).done(function(e){if(e&&e[0]){i.dataUser.id=e[0].id;var a=JSON.parse(e[0].allinfos);for(field in a)""!=a[field]&&null!=a[field]&&($(`input[name="${field}"]`).val(a[field]),"genre"==field&&$('select[name="genre"]').val(a[field]),"estadoregistro"==field&&$('select[name="estadoregistro"]').val(a[field]),"stateCode"==field&&$('select[name="stateCode"]').val(a[field]),"tiporegistro"==field&&$('select[name="tiporegistro"]').val(a[field]),"addressType"==field&&$('select[name="addressType"]').val(a[field]),"addressType"==field&&$('select[name="addressType"]').val(a[field]),"acceptCalls"==field&&$('input[name="acceptCalls"]').attr("checked",!0),"acceptSMS"==field&&$('input[name="acceptSMS"]').attr("checked",!0),"acceptEmail"==field&&$('input[name="acceptEmail"]').attr("checked",!0),"acceptMail"==field&&$('input[name="acceptMail"]').attr("checked",!0),"acceptInformativeMaterial"==field&&$('input[name="acceptInformativeMaterial"]').attr("checked",!0));localStorage.setItem("dagUserForm",JSON.stringify(a))}}))},applyMaksInFields:()=>{$("#inputDataNascimento").mask("00/00/0000",{placeholder:"__/__/____"}),$("#inputCpf").mask("000.000.000-00",{placeholder:"___.___.___-__"}),$("#inputCep").mask("00000-000",{placeholder:"_____-___"})},saveFormData:()=>{if(localStorage.getItem("dagUserForm")){var e=JSON.parse(localStorage.getItem("dagUserForm"));for(field in e)""!=e[field]&&null!=e[field]&&($(`input[name="${field}"]`).val(e[field]),"genre"==field&&$('select[name="genre"]').val(e[field]),"estadoregistro"==field&&$('select[name="estadoregistro"]').val(e[field]),"stateCode"==field&&$('select[name="stateCode"]').val(e[field]),"tiporegistro"==field&&$('select[name="tiporegistro"]').val(e[field]),"addressType"==field&&$('select[name="addressType"]').val(e[field]))}},applyValidate:()=>{let e=$("#dag-form-program-register");i.setValidateConfigs(e),e.on("submit",async function(r){if(r.preventDefault(),r.stopPropagation(),localStorage.getItem("dagCentralNumber")){if(e[0].checkValidity()){i.loading();let o=e.serializeObject();o.holderId.match(/[^\w\s]/g)&&(o.holderId=o.holderId.replace(/[^\w\s]/g,""));localStorage.getItem("dagUserCard")&&(console.log("Existe Cupom"),localStorage.getItem("dagUserCard"));var r={cardId:o.cardId||"",cardIdCompany:null,idCompany:null,cardIdOperator:null,idOperator:null,acceptTerm:"S",acceptEmail:o.acceptEmail&&"on"==o.acceptEmail?"S":"N",acceptMail:o.acceptMail&&"on"==o.acceptMail?"S":"N",acceptSMS:o.acceptSMS&&"on"==o.acceptSMS?"S":"N",acceptInformativeMaterial:o.acceptInformativeMaterial&&"on"==o.acceptInformativeMaterial?"S":"N",acceptCalls:o.acceptCalls&&"on"==o.acceptCalls?"S":"N"},r=(o={...o,...r},localStorage.setItem("dagUserForm",JSON.stringify(o)),{email:o.email,cpf:o.holderId,allinfos:JSON.stringify(o)}),l={type:o.tiporegistro,id:o.numeroregistroconselho,stateCode:o.estadoregistro,name:o.nomeprofissional};if(orionLocalStorage.getItem("dagCurrentProductPBM")){let e=JSON.parse(localStorage.getItem("dagCurrentProductPBM")),a={id:e.id,EAN:e.EAN,requestQuantity:e.requestedQuantity},t={currentCentralNumber:localStorage.getItem("dagCentralNumber"),consumer:o,product:[a],healthProfessional:l};if(delete t.consumer.tiporegistro,delete t.consumer.nomeprofissional,delete t.consumer.numeroregistroconselho,delete t.consumer.estadoregistro,null==i.dataUser.id){if(!(await i.sendDataToMD(r)).DocumentId)return void swal({title:"Problemas ao salvar os dados na base de dados.",icon:"warning",closeOnClickOutside:!1})}else if(!(await i.updateDataToMD(r)).DocumentId)return void swal({title:"Problemas ao salvar os dados na base de dados.",icon:"warning",closeOnClickOutside:!1});l=await i.sendDataInterplayers(t);if(l.process&&l.process.error&&l.process.error[0]&&l.process.error[0].returnCode)i.showErrorMessages(l.process.error[0]);else if("N000"==l.returnCode){localStorage.removeItem("dagCentralNumber");let e=localStorage.getItem("dagUrlProductRegister");localStorage.removeItem("dagUrlProductRegister"),localStorage.setItem("dagProductRegistered",!0),swal({title:"Cadastro realizado com sucesso!",text:"Agora você pode visualizar os descontos dos produtos.",icon:"success",closeOnClickOutside:!1}).then(()=>{window.location.pathname=e})}}else swal({title:"Atenção! Consulte pelo menos 1 produto para realizar o seu cadastro.",icon:"warning",closeOnClickOutside:!1}).then(()=>{console.log(respMD)})}}else alert("Central number não localizado, volte de aceite nos termos.")})},setValidateConfigs:e=>{e.validate({rules:{holderId:{required:!0},cardId:{required:!!localStorage.getItem("dagUserCard")},birthdate:{required:!0},name:{required:!0},genre:{required:!0},postalCode:{required:!0},stateCode:{required:!0},cityName:{required:!0},streetAddress:{required:!0},addressNumber:{required:!0},cellphone:{required:!0},phone:{required:!0},email:{required:!0},cityRegion:{required:!0},addressType:{required:!0}}})},sendDataToMD:e=>{return $.ajax({type:"POST",url:"https://drogariaglobo-middleware.herokuapp.com/middleware/v1/info-user",data:e})},updateDataToMD:e=>{return $.ajax({type:"PATCH",url:"https://drogariaglobo-middleware.herokuapp.com/middleware/v1/update-info-user",data:e})},sendDataInterplayers:e=>{e={type:"POST",url:"https://drogariaglobo-middleware.herokuapp.com/middleware/v1/active-customer",headers:{"Content-Type":"application/json",Accept:"application/vnd.vtex.ds.v10+json"},data:JSON.stringify(e)};return $.ajax(e)},formatBooleanInputsValues:e=>{"on"==e.acceptEmail?e.acceptEmail="S":e.acceptEmail="N","on"==e.acceptSMS?e.acceptSMS="S":e.acceptSMS="N","on"==e.acceptCalls?e.acceptCalls="S":e.acceptCalls="N","on"==e.acceptInformativeMaterial?e.acceptInformativeMaterial="S":e.acceptInformativeMaterial="N","on"==e.acceptMail?e.acceptMail="S":e.acceptMail="N"},showErrorMessages:e=>{"TD14"==e.returnCode?swal({title:"Atenção",text:"E-mail já cadastrado para outro usuário do programa, tente outro e-mail.",icon:"warning",closeOnClickOutside:!1}).then(()=>{$("#inputEmail").val()}):"Q285"==e.returnCode&&swal({title:"Atenção",text:"Número da central não localizado é necessario voce aceitar os termos.",icon:"warning",closeOnClickOutside:!1})},applyFixCheckbox:()=>{$(".form-check input").on("click",function(e){e.stopPropagation()}),$(".block-button-submit button").on("click",function(e){e.stopPropagation()})},loading:()=>{swal({icon:"https://drogariaglobo.vteximg.com.br/arquivos/drogariaglobo-loading-modal.gif",title:"Aguarda, efetuando seu cadastro...",text:"Por favor não saia ou recarregue a página",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,showCloseButton:!1,showCancelButton:!1,buttons:!1,closeOnClickOutside:!1,didOpen:()=>{Swal.showLoading()}})}};$(document).ready(i.init);$(window).load(function(){i.windowOnload()}),$(document).ajaxStop(i.ajaxStop)}catch(e){console.log("Erro na instância do [Register]: ",e)}}();